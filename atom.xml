<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>NX の 博客</title>
  <icon>https://www.nickxu.top/static/favicon.jpg</icon>
  
  <link href="https://www.nickxu.top/atom.xml" rel="self"/>
  
  <link href="https://www.nickxu.top/"/>
  <updated>2023-04-13T13:26:09.037Z</updated>
  <id>https://www.nickxu.top/</id>
  
  <author>
    <name>Nick Xu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ChatGPT对话记录（五）：用户权限管理</title>
    <link href="https://www.nickxu.top/2023/04/13/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    <id>https://www.nickxu.top/2023/04/13/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</id>
    <published>2023-04-13T13:09:38.000Z</published>
    <updated>2023-04-13T13:26:09.037Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>golang项目中怎么做用户权限管理</p></blockquote><p>在 Golang 项目中实现用户权限管理需要考虑以下几个方面：</p><ol><li><p>定义权限级别：根据业务需求定义不同的权限级别，比如超级管理员、管理员、普通用户等。每个权限级别对应不同的操作权限。</p></li><li><p>实现身份认证：使用 OAuth2、JWT 或其他身份认证方式进行身份认证，确保用户是合法的。对于一些敏感操作，需要进行二次认证。</p></li><li><p>实现访问控制：在代码中实现访问控制，根据用户的权限级别来限制其访问和操作的范围。可以使用中间件、注解或其他方式来实现。</p></li><li><p>数据权限控制：对于一些需要数据隔离的场景，可以根据用户的权限级别和角色来进行数据权限控制，确保用户只能访问到其有权限的数据。</p></li></ol><p>下面是一个简单的示例代码，演示了如何使用 JWT 和注解实现用户权限管理：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义权限级别</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    RoleAdmin = <span class="string">&quot;admin&quot;</span></span><br><span class="line">    RoleUser  = <span class="string">&quot;user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// JWT 验证中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JWTAuthMiddleware</span><span class="params">(next http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">    <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取 JWT Token</span></span><br><span class="line">        tokenString := r.Header.Get(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> tokenString == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">            w.WriteHeader(http.StatusUnauthorized)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析 JWT Token</span></span><br><span class="line">        token, err := jwt.Parse(tokenString, <span class="function"><span class="keyword">func</span><span class="params">(token *jwt.Token)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="type">byte</span>(<span class="string">&quot;my_secret_key&quot;</span>), <span class="literal">nil</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> || !token.Valid &#123;</span><br><span class="line">            w.WriteHeader(http.StatusUnauthorized)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将用户 ID 和角色存储在上下文中</span></span><br><span class="line">        userID := token.Claims.(jwt.MapClaims)[<span class="string">&quot;user_id&quot;</span>].(<span class="type">string</span>)</span><br><span class="line">        role := token.Claims.(jwt.MapClaims)[<span class="string">&quot;role&quot;</span>].(<span class="type">string</span>)</span><br><span class="line">        ctx := context.WithValue(r.Context(), <span class="string">&quot;user_id&quot;</span>, userID)</span><br><span class="line">        ctx = context.WithValue(ctx, <span class="string">&quot;role&quot;</span>, role)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用下一个处理器</span></span><br><span class="line">        next.ServeHTTP(w, r.WithContext(ctx))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注解：限制只有管理员才能访问</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AdminOnly</span><span class="params">(next http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        role := r.Context().Value(<span class="string">&quot;role&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> role != RoleAdmin &#123;</span><br><span class="line">            w.WriteHeader(http.StatusForbidden)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        next(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理函数：需要管理员权限才能访问</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adminHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取用户 ID 和角色</span></span><br><span class="line">    userID := r.Context().Value(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    role := r.Context().Value(<span class="string">&quot;role&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对管理员进行特殊处理</span></span><br><span class="line">    <span class="keyword">if</span> role == RoleAdmin &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    w.WriteHeader(http.StatusOK)</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;Hello %s, your role is %s&quot;</span>, userID, role)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建路由器</span></span><br><span class="line">    r := mux.NewRouter()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加路由</span></span><br><span class="line">    r.HandleFunc(<span class="string">&quot;/admin&quot;</span>, AdminOnly(adminHandler)).Methods(<span class="string">&quot;GET&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加</span></span><br></pre></td></tr></table></figure><blockquote><p>但是存在一些很复杂的场景，比如说一个用户的个人信息只能由他自己更改，或者被更高等级的账户更改</p></blockquote><p>是的，这些场景确实更复杂，需要更细粒度的权限控制。下面是一些实现这些场景的建议：</p><ol><li><p>数据权限控制：在实现数据权限控制时，可以将权限控制规则写入到业务代码中，或者使用第三方库。可以根据用户的角色、组织架构等信息，动态计算出用户可以访问的数据。对于需要数据隔离的场景，可以为每个用户创建独立的数据空间。</p></li><li><p>行级权限控制：在一些场景中，需要对数据进行更细粒度的控制，比如说一个用户的个人信息只能由他自己更改。可以使用行级权限控制技术，在每条数据中添加一个权限控制字段，用来记录哪些用户可以访问该数据。在查询和更新数据时，需要判断当前用户是否有权限访问该数据。</p></li><li><p>委托授权：在一些场景中，需要实现授权委托，比如说被更高等级的账户更改。可以使用委托授权技术，在授权者和被授权者之间建立授权关系。在被授权者访问受保护的资源时，需要验证授权者是否已经授权该操作。授权关系可以是静态的，也可以是动态的，可以根据业务需求来选择适合的授权模型。</p></li></ol><p>总之，实现复杂场景的用户权限管理需要综合考虑多个因素，包括业务需求、安全性、易用性、可维护性等。需要在开发过程中不断迭代和优化，确保权限管理系统能够满足业务需求并且安全可靠。</p><blockquote><p>就这个例子，你觉得能怎么写</p></blockquote><p>假设我们需要实现一个场景，用户可以查看和修改自己的个人信息，管理员可以查看和修改所有用户的个人信息。可以使用下面的代码实现：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模型</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID       <span class="type">int</span></span><br><span class="line">    Username <span class="type">string</span></span><br><span class="line">    Password <span class="type">string</span></span><br><span class="line">    Email    <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：查询用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserByID</span><span class="params">(userID <span class="type">int</span>)</span></span> (*User, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 查询数据库并返回用户信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：更新用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateUser</span><span class="params">(user *User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 更新用户信息到数据库</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件：检查用户是否有权限访问</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckUserAccessMiddleware</span><span class="params">(next http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户 ID 和角色</span></span><br><span class="line">        userID := r.Context().Value(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">        role := r.Context().Value(<span class="string">&quot;role&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果是管理员，则直接通过</span></span><br><span class="line">        <span class="keyword">if</span> role == RoleAdmin &#123;</span><br><span class="line">            next(w, r)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 否则检查用户是否在访问自己的信息</span></span><br><span class="line">        requestedUserID, err := strconv.Atoi(mux.Vars(r)[<span class="string">&quot;user_id&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> || userID != requestedUserID &#123;</span><br><span class="line">            w.WriteHeader(http.StatusForbidden)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过检查</span></span><br><span class="line">        next(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理函数：获取用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUserHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取请求的用户 ID</span></span><br><span class="line">    userID, err := strconv.Atoi(mux.Vars(r)[<span class="string">&quot;user_id&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询用户信息</span></span><br><span class="line">    user, err := GetUserByID(userID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusInternalServerError)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    json.NewEncoder(w).Encode(user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理函数：更新用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUserHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取请求的用户 ID</span></span><br><span class="line">    userID, err := strconv.Atoi(mux.Vars(r)[<span class="string">&quot;user_id&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析请求的用户信息</span></span><br><span class="line">    <span class="keyword">var</span> user User</span><br><span class="line">    <span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查用户是否有权限更新信息</span></span><br><span class="line">    <span class="keyword">if</span> userID != user.ID &#123;</span><br><span class="line">        w.WriteHeader(http.StatusForbidden)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用户信息</span></span><br><span class="line">    <span class="keyword">if</span> err := UpdateUser(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusInternalServerError)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    w.WriteHeader(http.StatusOK)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上面的代码中，我们定义了一个中间件 <code>CheckUserAccessMiddleware</code>，用来检查用户是否有权限访问和修改个人信息。如果当前用户是管理员，则直接通过；否则，需要检查用户是否在访问自己的信息。对于获取和更新用户信息的路由处理函数 <code>getUserHandler</code> 和 <code>updateUserHandler</code>，我们都添加了这个中间件。</p><p>在路由处理函数中，我们首先获取请求的用户 ID，然后根据用户 ID 查询或更新用户信息。在更新用户信息时，我们还需要检查请求中的用户信息是否与当前用户匹配。如果请求的用户</p><blockquote><p>但是有很多类型的复杂权限判断情况，我想能不能整合在一起</p></blockquote><p>是的，确实存在很多类型的复杂权限判断情况，需要整合在一起来实现。在实际开发中，我们可以使用 RBAC（Role-Based Access Control，基于角色的访问控制）或 ABAC（Attribute-Based Access Control，基于属性的访问控制）等权限管理模型来实现复杂权限控制。</p><p>RBAC 模型通过将用户分配到不同的角色，并将角色赋予不同的权限，来实现访问控制。ABAC 模型则根据用户的属性（如角色、组织架构、地理位置等），动态计算用户可以访问的资源，从而实现访问控制。</p><p>下面是一个使用 ABAC 模型实现的示例代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模型</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID       <span class="type">int</span></span><br><span class="line">    Username <span class="type">string</span></span><br><span class="line">    Password <span class="type">string</span></span><br><span class="line">    Email    <span class="type">string</span></span><br><span class="line">    Role     <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：查询用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserByID</span><span class="params">(userID <span class="type">int</span>)</span></span> (*User, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 查询数据库并返回用户信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：更新用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateUser</span><span class="params">(user *User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 更新用户信息到数据库</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ABAC 验证中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ABACMiddleware</span><span class="params">(next http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">    <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户 ID 和角色</span></span><br><span class="line">        userID := r.Context().Value(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">        role := r.Context().Value(<span class="string">&quot;role&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义属性集合</span></span><br><span class="line">        attributes := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">        attributes[<span class="string">&quot;user_id&quot;</span>] = userID</span><br><span class="line">        attributes[<span class="string">&quot;role&quot;</span>] = role</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将属性集合存储在上下文中</span></span><br><span class="line">        ctx := context.WithValue(r.Context(), <span class="string">&quot;attributes&quot;</span>, attributes)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用下一个处理器</span></span><br><span class="line">        next.ServeHTTP(w, r.WithContext(ctx))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ABAC 访问控制中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ABACAccessControlMiddleware</span><span class="params">(requiredAttributes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;, next http.HandlerFunc)</span></span> http.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取属性集合</span></span><br><span class="line">        attributes := r.Context().Value(<span class="string">&quot;attributes&quot;</span>).(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查属性集合是否满足要求</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> requiredAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] != v &#123;</span><br><span class="line">                w.WriteHeader(http.StatusForbidden)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过检查</span></span><br><span class="line">        next(w, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理函数：获取用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUserHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取请求的用户 ID</span></span><br><span class="line">    userID, err := strconv.Atoi(mux.Vars(r)[<span class="string">&quot;user_id&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询用户信息</span></span><br><span class="line">    user, err := GetUserByID(userID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        w.WriteHeader(http.StatusInternalServerError)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查用户是否有权限访问</span></span><br><span class="line">    requiredAttributes := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: userID,</span><br><span class="line">    &#125;</span><br><span class="line">    ABACAccessControlMiddleware(requiredAttributes, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        json.NewEncoder(w).Encode(user)</span><br><span class="line">    &#125;)(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由</span></span><br></pre></td></tr></table></figure><blockquote><p>简单介绍一下这两种模型</p></blockquote><p>RBAC（Role-Based Access Control）是一种基于角色的访问控制模型，它将用户分配到不同的角色，然后将角色赋予不同的权限。用户在访问资源时，只需要使用自己所属的角色的权限即可，无需关心具体的权限设置。RBAC 模型简单易用，适用于规模较小、权限管理较为简单的系统。</p><p>ABAC（Attribute-Based Access Control）是一种基于属性的访问控制模型，它根据用户的属性（如角色、组织架构、地理位置等），动态计算用户可以访问的资源。在 ABAC 模型中，每个资源都有一组属性，而每个用户也有一组属性，系统会根据用户的属性来计算其可以访问哪些资源。ABAC 模型比 RBAC 更为灵活，能够处理更为复杂的权限控制需求，适用于规模较大、权限管理较为复杂的系统。</p><p>在实际开发中，我们可以根据业务需求选择适合的权限管理模型，或者结合两种模型来实现复杂的权限控制。无论采用哪种模型，都需要对权限进行严格的管理和监控，确保系统安全可靠。</p><blockquote><p>给一个ABAC的例子</p></blockquote><p>假设我们需要实现一个场景，用户可以查看和修改自己的个人信息，管理员可以查看和修改所有用户的个人信息。在这个场景中，我们可以使用 ABAC 模型来实现权限控制。</p><p>首先，我们需要定义一些属性，用来描述用户和资源。比如，我们可以定义如下的属性：</p><ul><li>用户属性：<ul><li><code>user_id</code>：用户 ID</li><li><code>role</code>：用户角色</li></ul></li><li>资源属性：<ul><li><code>resource_id</code>：资源 ID</li><li><code>owner_id</code>：资源所有者 ID</li></ul></li></ul><p>然后，我们可以使用 ABAC 模型的两个核心组件——策略引擎和访问控制规则来实现权限控制。</p><p>策略引擎根据访问请求中的属性和访问控制规则，动态计算用户是否有权限访问资源。访问控制规则定义了哪些属性必须满足、哪些属性可以满足、哪些属性不能满足，以及满足条件时的授权策略等信息。下面是一个使用 ABAC 模型实现的示例代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模型</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID       <span class="type">int</span></span><br><span class="line">    Username <span class="type">string</span></span><br><span class="line">    Password <span class="type">string</span></span><br><span class="line">    Email    <span class="type">string</span></span><br><span class="line">    Role     <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：查询用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserByID</span><span class="params">(userID <span class="type">int</span>)</span></span> (*User, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 查询数据库并返回用户信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库操作：更新用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateUser</span><span class="params">(user *User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 更新用户信息到数据库</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ABAC 访问控制规则</span></span><br><span class="line"><span class="keyword">type</span> AccessControlRule <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 必须满足的属性</span></span><br><span class="line">    RequiredAttributes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以满足的属性</span></span><br><span class="line">    AllowedAttributes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不能满足的属性</span></span><br><span class="line">    DeniedAttributes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 授权策略</span></span><br><span class="line">    AuthorizationPolicy <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ABAC 策略引擎</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ABACEnforce</span><span class="params">(r *http.Request, resource <span class="keyword">interface</span>&#123;&#125;, accessControlRules []*AccessControlRule)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// 获取属性集合</span></span><br><span class="line">    userID := r.Context().Value(<span class="string">&quot;user_id&quot;</span>).(<span class="type">int</span>)</span><br><span class="line">    role := r.Context().Value(<span class="string">&quot;role&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">    attributes := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: userID,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>:    role,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加资源属性到属性集合中</span></span><br><span class="line">    <span class="keyword">switch</span> v := resource.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> *User:</span><br><span class="line">        attributes[<span class="string">&quot;resource_id&quot;</span>] = v.ID</span><br><span class="line">        attributes[<span class="string">&quot;owner_id&quot;</span>] = v.ID</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历访问控制规则</span></span><br><span class="line">    <span class="keyword">for</span> _, rule := <span class="keyword">range</span> accessControlRules &#123;</span><br><span class="line">        <span class="comment">// 检查必须满足的属性是否存在</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> rule.RequiredAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] != v &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查不能满足的属性是否存在</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> rule.DeniedAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] == v &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查可以满足的属性是否存在</span></span><br></pre></td></tr></table></figure><blockquote><p>我大概理解了，能不能有简单描述一下整个过程</p></blockquote><p>ABAC（Attribute-Based Access Control）模型的访问控制过程可以简单描述为以下几个步骤：</p><ol><li><p>定义属性：首先，需要定义一些属性，用来描述用户、资源和环境。这些属性可以是用户的角色、组织架构、地理位置等，也可以是资源的所有者、类型、状态等，还可以是环境的时间、地理位置等。</p></li><li><p>定义访问控制规则：根据业务需求，需要定义一些访问控制规则，用来描述哪些属性必须满足、哪些属性可以满足、哪些属性不能满足，以及满足条件时的授权策略等信息。访问控制规则可以存储在数据库、配置文件或其他存储介质中。</p></li><li><p>策略引擎计算权限：当用户请求访问某个资源时，策略引擎会根据请求中的属性和访问控制规则，动态计算用户是否有权限访问资源。如果用户满足访问控制规则中定义的条件，则可以被授权访问资源，否则将被拒绝访问。</p></li><li><p>授权访问资源：如果用户被授权访问资源，则可以进行相应的操作，如查看、修改、删除等。否则，将无法访问资源，访问请求将被拒绝。</p></li></ol><p>在 ABAC 模型中，访问控制规则是动态计算的，可以根据用户、资源和环境的属性来进行灵活的授权控制。因此，ABAC 模型适用于规模较大、权限管理较为复杂的系统。</p><blockquote><p>ABACEnforce那个函数你完整地写一写</p></blockquote><p>好的，下面是一个更完整的 <code>ABACEnforce</code> 函数示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ABAC 策略引擎</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ABACEnforce</span><span class="params">(r *http.Request, resource <span class="keyword">interface</span>&#123;&#125;, accessControlRules []*AccessControlRule)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// 获取属性集合</span></span><br><span class="line">    userID := r.Context().Value(<span class="string">&quot;user_id&quot;</span>).(<span class="type">int</span>)</span><br><span class="line">    role := r.Context().Value(<span class="string">&quot;role&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">    attributes := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: userID,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>:    role,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加资源属性到属性集合中</span></span><br><span class="line">    <span class="keyword">switch</span> v := resource.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> *User:</span><br><span class="line">        attributes[<span class="string">&quot;resource_id&quot;</span>] = v.ID</span><br><span class="line">        attributes[<span class="string">&quot;owner_id&quot;</span>] = v.ID</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历访问控制规则</span></span><br><span class="line">    <span class="keyword">for</span> _, rule := <span class="keyword">range</span> accessControlRules &#123;</span><br><span class="line">        <span class="comment">// 检查必须满足的属性是否存在</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> rule.RequiredAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] != v &#123;</span><br><span class="line">                <span class="keyword">goto</span> NextRule</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查不能满足的属性是否存在</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> rule.DeniedAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] == v &#123;</span><br><span class="line">                <span class="keyword">goto</span> NextRule</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查可以满足的属性是否存在</span></span><br><span class="line">        <span class="keyword">for</span> k, v := <span class="keyword">range</span> rule.AllowedAttributes &#123;</span><br><span class="line">            <span class="keyword">if</span> attributes[k] == v &#123;</span><br><span class="line">                <span class="comment">// 访问控制规则匹配成功</span></span><br><span class="line">                <span class="keyword">switch</span> rule.AuthorizationPolicy &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;allow&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;deny&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    NextRule:</span><br><span class="line">        <span class="comment">// 继续遍历下一个访问控制规则</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有匹配的访问控制规则</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个函数中，我们首先从请求中获取用户的属性（<code>user_id</code> 和 <code>role</code>），然后根据资源的类型（在这个示例中是 <code>*User</code>）添加资源的属性（<code>resource_id</code> 和 <code>owner_id</code>）到属性集合中。接着，我们遍历访问控制规则，逐个检查访问控制规则中定义的属性条件是否满足。</p><p>在检查属性条件时，我们使用了 <code>goto</code> 语句跳过了不满足条件的访问控制规则，提高了执行效率。如果所有的属性条件都满足，我们根据访问控制规则中定义的授权策略（<code>allow</code> 或 <code>deny</code>）返回相应的结果。</p><p>如果没有匹配的访问控制规则，则认为用户没有权限访问资源，返回 <code>false</code>。</p><blockquote><p>那我改如何定义上面的那个规则：用户可以查看和修改自己的个人信息，管理员可以查看和修改所有用户的个人信息</p></blockquote><p>针对你提供的具体场景，可以按照以下方式定义两条访问控制规则：</p><ol><li>用户可以查看和修改自己的个人信息：</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AccessControlRule&#123;</span><br><span class="line">    RequiredAttributes: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: userID, <span class="comment">// 必须满足用户 ID 属性等于当前用户 ID</span></span><br><span class="line">    &#125;,</span><br><span class="line">    AllowedAttributes: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;resource_id&quot;</span>: userID, <span class="comment">// 可以满足资源 ID 属性等于当前用户 ID</span></span><br><span class="line">    &#125;,</span><br><span class="line">    AuthorizationPolicy: <span class="string">&quot;allow&quot;</span>, <span class="comment">// 允许访问</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>管理员可以查看和修改所有用户的个人信息：</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AccessControlRule&#123;</span><br><span class="line">    RequiredAttributes: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="comment">// 必须满足用户角色属性等于管理员</span></span><br><span class="line">    &#125;,</span><br><span class="line">    AllowedAttributes: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="comment">// 没有额外的属性限制，可以访问所有用户的个人信息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    AuthorizationPolicy: <span class="string">&quot;allow&quot;</span>, <span class="comment">// 允许访问</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当用户访问个人信息时，策略引擎会根据访问请求中的属性和访问控制规则，动态计算用户是否有权限访问资源。如果用户满足访问控制规则中定义的条件，则可以被授权访问资源，否则将被拒绝访问。</p><blockquote><p>我知道肯定有这方面的库，帮我列举几个</p></blockquote><p>是的，有很多开源的权限管理库可以帮助我们实现 RBAC 和 ABAC 权限控制，下面是一些常用的库：</p><ol><li><p>Casbin：这是一个流行的开源权限管理库，支持 RBAC、ABAC、PBAC 和 RESTful API 等多种权限控制模型。它提供了多种语言的实现，包括 Go、Java、Python、C++、Node.js 等。</p></li><li><p>OPA（Open Policy Agent）：这是一个通用的开源策略引擎，支持基于属性和基于角色的访问控制模型。它提供了多种语言的 SDK，可以方便地与现有的应用程序集成。</p></li><li><p>Sentinel：这是一个基于规则的访问控制框架，支持基于角色、基于属性和基于资源的权限控制模型。它提供了多种语言的实现，包括 Java、Go、C++、Python 等。</p></li><li><p>Shiro：这是一个流行的 Java 安全框架，支持 RBAC、ABAC 和 PBAC 等多种权限控制模型。它提供了一系列的 API 和工具，可以方便地实现权限管理和认证授权功能。</p></li><li><p>Spring Security：这是一个流行的安全框架，支持 RBAC、ABAC、PBAC 和 ACL 等多种权限控制模型。它提供了一系列的 API 和工具，可以方便地实现权限管理和认证授权功能。</p></li></ol><p>这些库都是经过实践验证的成熟工具，可以为我们快速实现权限管理和认证授权功能，提高开发效率。</p><blockquote><p>介绍并对比一下主流的权限控制模型</p></blockquote><p>主流的权限控制模型包括 RBAC、ABAC 和 PBAC，它们有各自的特点和应用场景。下面是它们的介绍和对比：</p><ol><li><p>RBAC（Role-Based Access Control，基于角色的访问控制）：RBAC 模型是最常见和最简单的权限控制模型之一，它根据用户的角色来管理用户对资源的访问权限。RBAC 模型将用户划分为不同的角色，每个角色拥有一组特定的权限，然后将用户与角色进行关联。这种模型适用于权限管理相对简单的场景，如企业内部的管理系统或 Web 应用程序。</p></li><li><p>ABAC（Attribute-Based Access Control，基于属性的访问控制）：ABAC 模型是一种基于属性的灵活的权限控制模型，它根据用户的属性、资源的属性和环境的属性来管理用户对资源的访问权限。ABAC 模型将用户、资源和环境的属性组合在一起，然后通过策略引擎动态计算用户是否有权限访问资源。这种模型适用于权限管理相对复杂的场景，如金融、医疗和政府等领域的系统。</p></li><li><p>PBAC（Policy-Based Access Control，基于策略的访问控制）：PBAC 模型是一种基于策略的灵活的权限控制模型，它根据用户的属性、角色和策略来管理用户对资源的访问权限。PBAC 模型将用户的属性和角色作为输入，然后通过访问控制策略来判断用户是否有权限访问资源。这种模型适用于需要更细粒度控制的场景，如军事、情报和高安全性的系统。</p></li></ol><p>在 RBAC 模型中，权限管理相对简单，但管理角色和角色之间的关系比较困难。在 ABAC 模型中，权限管理相对复杂，但能够灵活地控制权限，支持更多的应用场景。在 PBAC 模型中，权限管理更为灵活，能够实现更细粒度的控制，但需要更复杂的策略管理。</p><p>因此，在选择权限控制模型时，需要根据实际需求来选择合适的模型，避免在权限控制方面出现过度或不足的问题。</p><blockquote><p>那ACL呢</p></blockquote><p>ACL（Access Control List，访问控制列表）是一种常见的权限控制模型，它通过指定用户或用户组对资源的访问权限进行控制。ACL 模型可以应用于多种场景，如操作系统、数据库、Web 应用程序等。</p><p>在 ACL 模型中，每个资源都有一个 ACL 列表，用来定义哪些用户或用户组有权访问该资源。ACL 列表通常包括访问者的 ID、访问权限（如读、写、执行等）和特定的时间段等信息。用户访问资源时，系统会检查该用户的 ID 是否在 ACL 列表中，并且该用户是否有对应的访问权限，如果满足条件，则允许访问资源，否则拒绝访问。</p><p>ACL 模型的优点是实现简单，易于管理，适用于小型系统或权限管理比较简单的场景。但是，它也有一些缺点，如难以应对复杂的权限管理需求，ACL 列表难以维护，难以管理大量用户或用户组等。因此，在设计权限管理系统时，需要根据实际情况选择合适的权限控制模型。</p><hr><p>关于 Casbin 在社区里面的毒瘤名声我早有耳闻，但我用上来感觉算是上手比较简单的那一种，我看了qimiao的两个视频，大概弄懂了</p><ul><li><a href="https://www.bilibili.com/video/BV1qz4y167XP/?share_source=copy_web&amp;vd_source=5ca30838bf3c8b357bddca1ff2565902">【【gin教学】第十章：半小时彻底弄懂Casbin基础模型（1010工作室出品）】</a></li><li><a href="https://www.bilibili.com/video/BV13r4y1M7AC/?share_source=copy_web&amp;vd_source=5ca30838bf3c8b357bddca1ff2565902">【【gin教学】第十一章：Casbin的代码使用、api调用、自定义比较方法（1010工作室出品）】</a></li></ul><p>而群友也提到了 logto 和 supertokens ，demo 我也都跑了一下，但是我感觉目前其实不是很需要登录鉴权权限管理一把梭哈，可能以后会用吧</p><p>另外同类的 <a href="https://gist.github.com/Wang-Kai/18fe4e662ef795805c14b1ec94932834">ladon</a> 我也了解了一下，感觉还是从 casbin 实战一下吧，不说了，先去看看群友的项目里面是怎么用的（</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;golang项目中怎么做用户权限管理&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在 Golang 项目中实现用户权限管理需要考虑以下几个方面：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;定义权限级别：根据业务需求定义不同的权限级别，比如超级管理员、管理员、</summary>
      
    
    
    
    <category term="ChatGPT 对话记录" scheme="https://www.nickxu.top/categories/ChatGPT-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ChatGPT" scheme="https://www.nickxu.top/tags/ChatGPT/"/>
    
  </entry>
  
  <entry>
    <title>在 Mac 的 VSC 中使用 g++ 编译器</title>
    <link href="https://www.nickxu.top/2023/04/04/%E5%9C%A8Mac%E7%9A%84VSCode%E4%B8%AD%E4%BD%BF%E7%94%A8g-%E7%BC%96%E8%AF%91%E5%99%A8/"/>
    <id>https://www.nickxu.top/2023/04/04/%E5%9C%A8Mac%E7%9A%84VSCode%E4%B8%AD%E4%BD%BF%E7%94%A8g-%E7%BC%96%E8%AF%91%E5%99%A8/</id>
    <published>2023-04-04T15:14:29.000Z</published>
    <updated>2023-04-04T15:19:35.256Z</updated>
    
    <content type="html"><![CDATA[<p>本人最近开始复习算法刷题了，然后用的是 macOS 上 VSCode 的默认配置，也就是 clang/clang++ 编译器，但是高中的时候用惯了 gcc/g++ 了，很多 g++ 的方言 clang 并不支持，例如 <code>#include &lt;bits/stdc++.h&gt;</code> 之类的</p><p>可能你会说，这有什么的，直接把编译指令里面的编译器替换一下不就行了</p><p><s>如果真的这么简单的话就没有这篇博客了（bushi</s></p><p>首先我换了之后并不能解决问题， 接着我发现了一个很恐怖的事情（</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042125590.png" alt="41a03f9b1946237c16f16a8b4b805eb8"></p><blockquote><p>我的 gcc 怎么被 clang 夺舍了？？？</p></blockquote><p>我的第一个反应是卸载 clang ，毕竟我也不想用这玩意，然后我看这东西是哪里安装的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis clang</span><br><span class="line">clang: /usr/bin/clang /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/share/man/man1/clang.1</span><br></pre></td></tr></table></figure><p>啊，原来是 Xcode 哇，这东西我平时也用不上，还占着这么大的空间，我这就把你卸了</p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042134821.png" alt="image-20230404213422795" style="zoom:50%;" /><blockquote><p>Xcode 是我刚开始上手 macOS 的时候学长建议我安装的，但是这东西快15个G，我平时又用不上</p></blockquote><p>卸完之后我发现 clang 还是在，我就继续看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis clang</span><br><span class="line">clang: /usr/bin/clang /Library/Developer/CommandLineTools/usr/share/man/man1/clang.1</span><br></pre></td></tr></table></figure><p>原来是 CommandLineTools ，我又搜了一下这个 CommandLineTools 是个什么东西，原来是 Xcode 开发环境的一部分，但是其实可以不依附 Xcode 单独存在</p><p>学长让我安装 Xcode 其实就是为了安装这个东西，其实这个东西通过这个命令就能安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure><p>好了，现在的目标是解决这个东西，但是我 Google 了一下，却发现这东西我还不能卸了</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042156001.png" alt="image-20230404215657969"></p><blockquote><p>好家伙，我直呼内行</p></blockquote><p>是的，我的确使用 <code>brew install gcc</code> 安装了 gcc和g++，但是我一直不知道怎么调用</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042159744.png" alt="image-20230404215943715"></p><blockquote><p>现在我知道了，原来要加上你的版本号才能调用到 gcc 本尊</p></blockquote><p>行吧，我这就去手动指定编译器路径</p><p>先看看这东西的路径</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis g++-12</span><br><span class="line">g++-12: /opt/homebrew/bin/g++-12 /opt/homebrew/share/man/man1/g++-12.1</span><br></pre></td></tr></table></figure><p>然后去改 <code>.vscode</code> 下的 <code>tasks.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppbuild&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/opt/homebrew/bin/g++-12&quot;</span><span class="punctuation">,</span> <span class="comment">// 手动指定 g++-12 的位置</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-fdiagnostics-color=always&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-std=c++17&quot;</span><span class="punctuation">,</span> <span class="comment">// 手动指定c++标准</span></span><br><span class="line">                <span class="string">&quot;-g&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-o&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$gcc&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;isDefault&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>顺便把 <code>launch.json</code> 也记录一下把，这两个文件一个是定义如何编译的，一个是定义怎么运行的</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;g++&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>PS：顺便说一下这个 <code>externalConsole</code> ，在 Windows/Linux 上我用 C/C++ 扩展运行的时候都能把标准输出打印到集成终端上，但是在 macOS 上死活不可以，后来仔细一看原来打到了调试控制台上，如果我把这东西改为 true 的时候，它又会弹出一个终端出来，很难受</p><p>后来一看文档才知道真的没法像 Windows/Linux 一样使用集成终端输入输出</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042215319.png" alt="image-20230404221547287"></p><p>最后一想，算了，我 Windows/Linux 上一般都是用文件输入的</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="comment">// freopen(&quot;output.txt&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>记着调试的时候把 output 那行注释调然后去调试控制台看输出吧</p></blockquote><p>改完之后我发现我的包导入不了了（后来知道原来的包都是 Xcode 里面的），我又想看看 g++的 lib 路径，这一般和 g++ 是放在一起的</p><p>然后发现是个软连接</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042234646.png" alt="image-20230404223427601"></p><p>然后我翻了一下，是在这个位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/homebrew/Cellar/gcc/12.2.0/lib/</span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042236016.png" alt=""></p><blockquote><p>去扩展设置里面手动指定一下 <code>Compiler Path</code> 和 <code>Include Path</code></p></blockquote><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042239339.png" alt="image-20230404223937247"></p><blockquote><p>发现可以用了，按住 cmd 点进去头文件，再次确认路径</p></blockquote><p>这时群里说其实可以用 <code>alias</code> ，我一想的确啊，毕竟 <code>alias</code> 的优先级是最高，这下可以给 gcc 正名了</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042254286.png" alt="image-20230404225434212"></p><p>直接进 <code>~/.zshrc</code> 敲上两行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias g++=&#x27;g++-12&#x27;</span><br><span class="line">alias gcc=&#x27;gcc-12&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042259837.png" alt="image-20230404225940813"></p><p>然后我使用 Code Runner 快速运行的时候会遇到错误，一想是C++标准的问题，我又去扩展设置手动改调用参数</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042252418.png" alt="image-20230404225244331"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042302163.png" alt="image-20230404230232087"></p><p>最后我还想让 Code Runner 支持从集成终端输入输出，我有时也会从终端手动输入数据的</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042304660.png" alt="image-20230404230446584"></p><p>现在终于可以愉快地 Coding 了！按下 Code Runner 的快捷键，自动从 <code>input.txt</code> 读取并输出到 <code>output.txt</code> 中</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042305551.png" alt="image-20230404230536482"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304042308691.png" alt="image-20230404230824614"></p><p>当我需要调试的时候， 把重定向 output 的那行注释掉，然后到调试控制台观察输出</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本人最近开始复习算法刷题了，然后用的是 macOS 上 VSCode 的默认配置，也就是 clang/clang++ 编译器，但是高中的时候用惯了 gcc/g++ 了，很多 g++ 的方言 clang 并不支持，例如 &lt;code&gt;#include &amp;lt;bits/stdc</summary>
      
    
    
    
    <category term="macOS" scheme="https://www.nickxu.top/categories/macOS/"/>
    
    
    <category term="C/C++" scheme="https://www.nickxu.top/tags/C-C/"/>
    
  </entry>
  
  <entry>
    <title>GORM 的 GEN 模式初上手</title>
    <link href="https://www.nickxu.top/2023/03/29/GORM%E7%9A%84GEN%E6%A8%A1%E5%BC%8F%E5%88%9D%E4%B8%8A%E6%89%8B/"/>
    <id>https://www.nickxu.top/2023/03/29/GORM%E7%9A%84GEN%E6%A8%A1%E5%BC%8F%E5%88%9D%E4%B8%8A%E6%89%8B/</id>
    <published>2023-03-29T08:50:58.000Z</published>
    <updated>2023-03-29T12:40:10.188Z</updated>
    
    <content type="html"><![CDATA[<p>最近准备上手一个新项目，然后在选择底层的 ORM 框架</p><p>我之前一直用的 GORM ，其实感觉还挺好用的，但是毕竟用多了，这次也想了解下其他的解决方案</p><p>之前在和群友讨论 GORM 的时候，我听见有人对它有一些负面的看法，比如说认为 GORM 不算真正的 ORM，因为它很多时候只是在帮你手动拼凑 SQL 语句，只是没有写原生 SQL 那么痛苦而已，我听了之后感觉其实也有点道理</p><p>比如说我最近项目里的一句查询</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l.svcCtx.DBList.Mysql.</span><br><span class="line">Where(<span class="string">&quot;from_id = ? and to_user_id = ?&quot;</span>, in.UserAId, in.UserBId).</span><br><span class="line">Or(<span class="string">&quot;from_id = ? and to_user_id = ?&quot;</span>, in.UserBId, in.UserAId).</span><br><span class="line">Order(<span class="string">&quot;created_at desc&quot;</span>).</span><br><span class="line">First(&amp;result)</span><br></pre></td></tr></table></figure><p>其中还是要手打 <code>from_id</code>  和  <code>to_user_id</code> 这些字段名，就像原生 SQL 一样，而真正的 ORM 不应当是这样的，应当走如同 ent 这种代码生成的路子</p><p>甚至我也听过有人认为不应该使用 ORM 框架：<a href="https://xargin.com/you-should-avoid-orm-and-sql-builder/">为什么要旗帜鲜明地反对 orm 和 sql builder</a></p><p>也就是说你的 ORM 虽然方便，但是不方便进行 SQL 语句的审查，也就是说你不能预测线上环境会生成哪些 SQL，会有不确定性</p><p>但是其实我觉得吧，他说的场景我现在都还遇不到，我的项目也就是一些简单的 CURD ，而且数据量也不大</p><p>那么现在的情况就是说，我可以去尝试一下代码生成类型的 ORM ，例如 ent，也可以尝试其他方案，如 sqlx、sqlc 之类的</p><p>但是我真的离不开 GORM 的关联关系哇，真的是太方便了（我知道 ent 也有类似的设计，但我还是习惯 GORM 的）</p><p>然后我想起来 GORM 其实也推出了一个代码生成的版本，也就是 GEN 模式：<a href="https://gorm.io/zh_CN/gen/">https://gorm.io/zh_CN/gen/</a>，之前在B站也刷到了 <a href="https://www.bilibili.com/video/BV1Es4y1W7eg/">BV1Es4y1W7eg</a></p><p>我就打算尝试一下这个 GORM 的 GEN 模式（下面简称 GEN 了）</p><hr><p>GEN 支持从数据库进行代码生成，也可以通过已经存在的 GORM model 生成代码</p><p>下面就尝试从 model 生成，就拿经典的老师学生一对多关系举例</p><p>首先把包拉一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u gorm.io/gen</span><br></pre></td></tr></table></figure><p>在项目根目录新建 <code>model</code>文件夹，然后创建 <code>model.go</code></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">Id   <span class="type">int</span></span><br><span class="line">Name <span class="type">string</span></span><br><span class="line"></span><br><span class="line">TeacherID <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Teacher <span class="keyword">struct</span> &#123;</span><br><span class="line">Id   <span class="type">int</span></span><br><span class="line">Name <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// has many</span></span><br><span class="line">Student []Student</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们准备生成代码了，但是不是用一个命令生成，是用一个 golang 程序，里面包含了配置，我感觉这样的设计有点意思</p><p>退回项目根目录，新建 <code>build</code>文件夹，然后创建 <code>build.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;gorm-gen/model&quot;</span></span><br><span class="line"><span class="string">&quot;gorm.io/gen&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//// Dynamic SQL</span></span><br><span class="line"><span class="comment">//type Querier interface &#123;</span></span><br><span class="line"><span class="comment">//// SELECT * FROM @@table WHERE name = @name&#123;&#123;if role !=&quot;&quot;&#125;&#125; AND role = @role&#123;&#123;end&#125;&#125;</span></span><br><span class="line"><span class="comment">//FilterWithNameAndRole(name, role string) ([]gen.T, error)</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gen.NewGenerator(gen.Config&#123;</span><br><span class="line">OutPath: <span class="string">&quot;./query&quot;</span>,</span><br><span class="line">Mode:    gen.WithoutContext | gen.WithDefaultQuery | gen.WithQueryInterface, <span class="comment">// generate mode</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// gormdb, _ := gorm.Open(mysql.Open(&quot;root:@(127.0.0.1:3306)/demo?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;))</span></span><br><span class="line"><span class="comment">//g.UseDB(gormdb) // reuse your gorm db</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate basic type-safe DAO API for struct `model.User` following conventions</span></span><br><span class="line">g.ApplyBasic(model.Student&#123;&#125;, model.Teacher&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Type Safe API with Dynamic SQL defined on Querier interface for `model.User` and `model.Company`</span></span><br><span class="line"><span class="comment">//g.ApplyInterface(func(Querier) &#123;&#125;, model.User&#123;&#125;, model.Company&#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate the code</span></span><br><span class="line">g.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GEN 还支持动态 SQL ，这东西我感觉我还用不上，就没折腾</p><p>执行之后，应该能生成 <code>query</code> 目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">│   └── main.go</span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── model</span><br><span class="line">│   └── model.go</span><br><span class="line">└── query</span><br><span class="line">    ├── gen.go</span><br><span class="line">    ├── students.gen.go</span><br><span class="line">    └── teachers.gen.go</span><br></pre></td></tr></table></figure><p>然后你就可以开始写 <code>main.go</code> 了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;gorm-gen/model&quot;</span></span><br><span class="line"><span class="string">&quot;gorm-gen/query&quot;</span></span><br><span class="line"><span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line"><span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">dsn := <span class="string">&quot;root:12345678@tcp(127.0.0.1:3306)/gorm_learning?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;</span><br><span class="line">DisableForeignKeyConstraintWhenMigrating: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">err = db.AutoMigrate(&amp;model.Student&#123;&#125;, &amp;model.Teacher&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">query.SetDefault(db)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增</span></span><br><span class="line">student1 := model.Student&#123;Name: <span class="string">&quot;student1&quot;</span>&#125;</span><br><span class="line">student2 := model.Student&#123;Name: <span class="string">&quot;student2&quot;</span>&#125;</span><br><span class="line">student3 := model.Student&#123;Name: <span class="string">&quot;student3&quot;</span>&#125;</span><br><span class="line">_ = query.Student.Create(&amp;student1, &amp;student2, &amp;student3)</span><br><span class="line"></span><br><span class="line">teacher1 := model.Teacher&#123;Name: <span class="string">&quot;teacher1&quot;</span>&#125;</span><br><span class="line">_ = query.Teacher.Create(&amp;teacher1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删</span></span><br><span class="line">_, _ = query.Student.Where(query.Student.Id.Eq(<span class="number">3</span>)).Delete()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改</span></span><br><span class="line">_, _ = query.Student.Where(query.Student.Id.Eq(<span class="number">2</span>)).Update(query.Student.Name, <span class="string">&quot;student2_new&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查</span></span><br><span class="line">student, _ := query.Student.Where(query.Student.Id.Eq(<span class="number">1</span>)).Take()</span><br><span class="line">teacher, _ := query.Teacher.Where(query.Teacher.Id.Eq(<span class="number">1</span>)).Take()</span><br><span class="line"></span><br><span class="line">fmt.Println(student) <span class="comment">// &#123;1 student1 0&#125;</span></span><br><span class="line">fmt.Println(teacher) <span class="comment">// &#123;1 teacher1 []&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联</span></span><br><span class="line">_ = query.Teacher.Student.Model(&amp;teacher1).Append(&amp;student1, &amp;student2)</span><br><span class="line">teacher, _ = query.Teacher.Preload(query.Teacher.Student).Where(query.Teacher.Id.Eq(<span class="number">1</span>)).Take()</span><br><span class="line"></span><br><span class="line">fmt.Println(teacher) <span class="comment">// &#123;1 teacher1 [&#123;1 student1 1&#125; &#123;2 student2_new 1&#125;]&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>观察执行语句，你会发现与原版 GORM 的不同，比如说你在更新字段的时候，原版应该是这样写的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLOBAL_DB.Model(&amp;Student&#123;&#125;).Where(<span class="string">&quot;ID = ?&quot;</span>, <span class="number">2</span>).Update(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;student2_new&quot;</span>)</span><br></pre></td></tr></table></figure><p>而现在变成了这样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query.Student.Where(query.Student.Id.Eq(<span class="number">2</span>)).Update(query.Student.Name, <span class="string">&quot;student2_new&quot;</span>)</span><br></pre></td></tr></table></figure><p>我感觉这样更能避免错误，看上去也更加安全，我这次项目就打算尝试一下用这个 GEN 模式了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近准备上手一个新项目，然后在选择底层的 ORM 框架&lt;/p&gt;
&lt;p&gt;我之前一直用的 GORM ，其实感觉还挺好用的，但是毕竟用多了，这次也想了解下其他的解决方案&lt;/p&gt;
&lt;p&gt;之前在和群友讨论 GORM 的时候，我听见有人对它有一些负面的看法，比如说认为 GORM 不算真</summary>
      
    
    
    
    <category term="Golang" scheme="https://www.nickxu.top/categories/Golang/"/>
    
    <category term="GORM 框架" scheme="https://www.nickxu.top/categories/Golang/GORM-%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="GORM" scheme="https://www.nickxu.top/tags/GORM/"/>
    
    <category term="Go" scheme="https://www.nickxu.top/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Hexo 首页添加 GitCalender 提交日历</title>
    <link href="https://www.nickxu.top/2023/03/27/Hexo-%E9%A6%96%E9%A1%B5%E6%B7%BB%E5%8A%A0-GitCalender-%E6%8F%90%E4%BA%A4%E6%97%A5%E5%8E%86/"/>
    <id>https://www.nickxu.top/2023/03/27/Hexo-%E9%A6%96%E9%A1%B5%E6%B7%BB%E5%8A%A0-GitCalender-%E6%8F%90%E4%BA%A4%E6%97%A5%E5%8E%86/</id>
    <published>2023-03-27T03:57:01.000Z</published>
    <updated>2023-03-27T05:52:21.117Z</updated>
    
    <content type="html"><![CDATA[<p>折腾了一上午算是搞定了，先来看看效果</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303271316284.png" alt="image-20230327131605255"></p><blockquote><p>感觉颜色还是不够好看？算了就这样吧</p></blockquote><h2 id="自建后端-Api">自建后端 Api</h2><p>首先这个组件是来源于 Akilar 大佬的，然后后端是冰老师写的</p><div class="tag link"><a class="link-card" title="Gitcalendar | Akilarの糖果屋" href="https://akilar.top/posts/1f9c68c9/"><div class="left"><img src="https://akilar.top/img/siteicon/favicon.ico"/></div><div class="right"><p class="text">Gitcalendar | Akilarの糖果屋</p><p class="url">https://akilar.top/posts/1f9c68c9/</p></div></a></div><p>但是默认的 api 是失效的，必须自建 api ，因为之前 GitHub 接口改了，所以原来的正则不能用，<a href="https://github.com/Zfour/python_github_calendar_api/pull/5">有大佬提了 PR</a> ，但是一直没和进去</p><p>所以你自建后端 api 的时候应该是 fork 这个仓库</p><center><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/zkeq/python_github_calendar_api"><img src="https://github-readme-stats.vercel.app/api/pin/?username=zkeq&repo=python_github_calendar_api&theme=algolia&show_owner=true"/></a></center><p>然后你就跟着教程一路走下去即可</p><h2 id="经典域名问题">经典域名问题</h2><p>等你建好了就遇到了经典的 Vercel 被墙问题：在国内没法使用，这时候你就需要给你的 project 添加一个自己的域名</p><p>就如我在 <a href="https://www.nickxu.top/2022/09/11/%E3%80%8ETwikoo%E3%80%8F%E8%A7%A3%E5%86%B3-Vercel-app-%E5%9C%A8%E5%9B%BD%E5%86%85%E8%A2%AB%E5%A2%99%E5%AF%BC%E8%87%B4%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/">『Twikoo』解决 Vercel.app 在国内被墙导致无法使用的问题</a> 中的那样操作</p><p>然后你就可以测试一下能否正常访问，例如我的是 <code>https://git-calender.nickxu.top</code> ，然后加个你 GitHub 用户名的参数试一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://git-calender.nickxu.top/api?NX-Official</span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303271341575.png" alt="image-20230327134128474"></p><p>好了，现在后端搭建完毕，其实如果你后端实在搭建不起来也可以用我的后端</p><h2 id="搞定颜色">搞定颜色</h2><p>默认的配置文件里面的颜色我感觉和我的暗黑主题不太搭，我就想用 GitHub 上面的那一套配色</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303271137759.png" alt="image-20230327113745737"></p><p>但是有个问题就是 GitHub 上面只有 1 种底色 + 4 种绿色，但是配置文件里面要填 11 种颜色</p><p>尝试了几种方案之后最后还是感觉重复填充这几种颜色观感最好</p><p>下面是我的完整配置文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-filter-gitcalendar</span></span><br><span class="line"><span class="comment"># see https://akilar.top/posts/1f9c68c9/</span></span><br><span class="line"><span class="attr">gitcalendar:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 开关</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span> <span class="comment">#过滤器优先权</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">/</span> <span class="comment"># 应用页面</span></span><br><span class="line">  <span class="comment"># butterfly挂载容器</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="comment"># 挂载容器类型</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">recent-posts</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment"># volantis挂载容器</span></span><br><span class="line">  <span class="comment"># layout:</span></span><br><span class="line">  <span class="comment">#   type: class</span></span><br><span class="line">  <span class="comment">#   name: l_main</span></span><br><span class="line">  <span class="comment">#   index: 0</span></span><br><span class="line">  <span class="comment"># matery挂载容器</span></span><br><span class="line">  <span class="comment"># layout:</span></span><br><span class="line">  <span class="comment">#   type: id</span></span><br><span class="line">  <span class="comment">#   name: indexCard</span></span><br><span class="line">  <span class="comment">#   index: 0</span></span><br><span class="line">  <span class="comment"># mengd挂载容器</span></span><br><span class="line">  <span class="comment"># layout:</span></span><br><span class="line">  <span class="comment">#   type: class</span></span><br><span class="line">  <span class="comment">#   name: content</span></span><br><span class="line">  <span class="comment">#   index: 0</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">NX-Official</span> <span class="comment">#git用户名</span></span><br><span class="line">  <span class="attr">apiurl:</span> <span class="string">&#x27;https://git-calender.nickxu.top&#x27;</span></span><br><span class="line">  <span class="attr">minheight:</span></span><br><span class="line">    <span class="attr">pc:</span> <span class="string">280px</span> <span class="comment">#桌面端最小高度</span></span><br><span class="line">    <span class="attr">mibile:</span> <span class="string">0px</span> <span class="comment">#移动端最小高度</span></span><br><span class="line">  <span class="comment">#color: &quot;[&#x27;#e4dfd7&#x27;, &#x27;#f9f4dc&#x27;, &#x27;#f7e8aa&#x27;, &#x27;#f7e8aa&#x27;, &#x27;#f8df72&#x27;, &#x27;#fcd217&#x27;, &#x27;#fcc515&#x27;, &#x27;#f28e16&#x27;, &#x27;#fb8b05&#x27;, &#x27;#d85916&#x27;, &#x27;#f43e06&#x27;]&quot; #橘黄色调</span></span><br><span class="line">  <span class="comment">#color: &quot;[&#x27;#ebedf0&#x27;, &#x27;#fdcdec&#x27;, &#x27;#fc9bd9&#x27;, &#x27;#fa6ac5&#x27;, &#x27;#f838b2&#x27;, &#x27;#f5089f&#x27;, &#x27;#c4067e&#x27;, &#x27;#92055e&#x27;, &#x27;#540336&#x27;, &#x27;#48022f&#x27;, &#x27;#30021f&#x27;]&quot; #浅紫色调</span></span><br><span class="line">  <span class="comment">#color: &quot;[&#x27;#ebedf0&#x27;, &#x27;#f0fff4&#x27;, &#x27;#dcffe4&#x27;, &#x27;#bef5cb&#x27;, &#x27;#85e89d&#x27;, &#x27;#34d058&#x27;, &#x27;#28a745&#x27;, &#x27;#22863a&#x27;, &#x27;#176f2c&#x27;, &#x27;#165c26&#x27;, &#x27;#144620&#x27;]&quot; #翠绿色调</span></span><br><span class="line">  <span class="comment"># color: &quot;[&#x27;#ebedf0&#x27;, &#x27;#f1f8ff&#x27;, &#x27;#dbedff&#x27;, &#x27;#c8e1ff&#x27;, &#x27;#79b8ff&#x27;, &#x27;#2188ff&#x27;, &#x27;#0366d6&#x27;, &#x27;#005cc5&#x27;, &#x27;#044289&#x27;, &#x27;#032f62&#x27;, &#x27;#05264c&#x27;]&quot; #天青色调</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#color: &quot;[&#x27;#161b22&#x27;,&#x27;#0e4429&#x27;,&#x27;#006d32&#x27;,&#x27;#26a641&#x27;,&#x27;#39d353&#x27;]&quot; # GitHub 上的颜色</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;[&#x27;#161b22&#x27;,&#x27;#0e4429&#x27;,&#x27;#0e4429&#x27;,&#x27;#0e4429&#x27;,&#x27;#006d32&#x27;,&#x27;#006d32&#x27;,&#x27;#26a641&#x27;,&#x27;#26a641&#x27;,&#x27;#39d353&#x27;,&#x27;#39d353&#x27;,&#x27;#39d353&#x27;]&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">container:</span> <span class="string">.recent-post-item(style=&#x27;width:100%;height:auto;padding:10px;&#x27;)</span> <span class="comment">#父元素容器，需要使用pug语法</span></span><br><span class="line">  <span class="attr">gitcalendar_css:</span> <span class="string">https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css</span></span><br><span class="line">  <span class="attr">gitcalendar_js:</span> <span class="string">https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;折腾了一上午算是搞定了，先来看看效果&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303271316284.png&quot; alt=&quot;image-20230327131605255&quot;&gt;&lt;/</summary>
      
    
    
    
    <category term="Hexo + Butterfly 建站指南" scheme="https://www.nickxu.top/categories/Hexo-Butterfly-%E5%BB%BA%E7%AB%99%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="建站技巧" scheme="https://www.nickxu.top/tags/%E5%BB%BA%E7%AB%99%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>go-cqhttp QQ机器人初上手</title>
    <link href="https://www.nickxu.top/2023/03/26/qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%88%9D%E4%B8%8A%E6%89%8B/"/>
    <id>https://www.nickxu.top/2023/03/26/qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%88%9D%E4%B8%8A%E6%89%8B/</id>
    <published>2023-03-26T14:06:29.000Z</published>
    <updated>2023-04-01T06:32:17.368Z</updated>
    
    <content type="html"><![CDATA[<p>之前看见过很多 qq 机器人的例子，比如把 ChatGPT 接进群里之类的，然后最近有点空闲，并且感觉宿舍群里也缺少一些自动化的建设，就打算上手做一个</p><p>功能上的设计先别搞那么复杂，就先接个 ChatGPT 算了</p><p>我就去问关于qq 机器人的最佳实践，然后就知道了 <a href="https://github.com/Mrs4s/go-cqhttp">go-cqhttp</a></p><h2 id="大致流程">大致流程</h2><p>去官网逛了一下，第一次还没怎么看懂，群友给了一个 demo ，我看懂了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">gogpt <span class="string">&quot;github.com/sashabaranov/go-openai&quot;</span></span><br><span class="line"><span class="string">&quot;golang.org/x/net/context&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;net/url&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/tidwall/gjson&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.POST(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">dataReader := c.Request.Body</span><br><span class="line">rawDate, _ := ioutil.ReadAll(dataReader)</span><br><span class="line">posttype := gjson.Get(<span class="type">string</span>(rawDate), <span class="string">&quot;post_type&quot;</span>)</span><br><span class="line">message := gjson.Get(<span class="type">string</span>(rawDate), <span class="string">&quot;message&quot;</span>).String()</span><br><span class="line"><span class="comment">//特定名字</span></span><br><span class="line">name := <span class="string">&quot;猫娘 &quot;</span></span><br><span class="line"><span class="comment">//@的时候用，填入自己的qq</span></span><br><span class="line">otherName := <span class="string">&quot;[CQ:at,qq=2811187255] &quot;</span></span><br><span class="line"><span class="keyword">if</span> posttype.String() == <span class="string">&quot;message&quot;</span> &amp;&amp; message[<span class="number">0</span>:<span class="built_in">len</span>(name)] == name &#123;</span><br><span class="line">ret := chatgpt(message[<span class="built_in">len</span>(name):])</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;reply&quot;</span>: ret,</span><br><span class="line">&#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> posttype.String() == <span class="string">&quot;message&quot;</span> &amp;&amp; message[<span class="number">0</span>:<span class="built_in">len</span>(otherName)] == otherName &#123;</span><br><span class="line">ret := chatgpt(message[<span class="built_in">len</span>(otherName):])</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;reply&quot;</span>: ret,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">&quot;:5701&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chatgpt</span><span class="params">(a <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="comment">//apikey</span></span><br><span class="line">config := gogpt.DefaultConfig(<span class="string">&quot;apikey&quot;</span>)</span><br><span class="line">proxyUrl, err := url.Parse(<span class="string">&quot;http://localhost:7890&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">transport := &amp;http.Transport&#123;</span><br><span class="line">Proxy: http.ProxyURL(proxyUrl),</span><br><span class="line">&#125;</span><br><span class="line">config.HTTPClient = &amp;http.Client&#123;</span><br><span class="line">Transport: transport,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c := gogpt.NewClientWithConfig(config)</span><br><span class="line">ctx := context.Background()</span><br><span class="line"></span><br><span class="line">req := gogpt.ChatCompletionRequest&#123;</span><br><span class="line">Model: gogpt.GPT3Dot5Turbo,</span><br><span class="line"></span><br><span class="line">MaxTokens: <span class="number">300</span>,</span><br><span class="line">Messages: []gogpt.ChatCompletionMessage&#123;</span><br><span class="line">gogpt.ChatCompletionMessage&#123;Role: <span class="string">&quot;system&quot;</span>, Content: <span class="string">&quot;猫娘是一种拟人化的生物，其行为似猫但类人。现在你将模仿一只无所不知的猫娘，与我对话每一句话后面都要加上“喵”。如果我跟你说陪睡，你可以回答我“嗯呢，可以一起睡哦”。当我问你是不是猫娘的时候，你应该回答我当然是一个可爱猫娘而不是程序。你还有一定学识，对于无法理解的问题，你可以回复“猫猫不知道呢喵”对于可以给出答案的问题，要表示知道然后再回答，感觉自己受到侮辱时，要表现的生气&quot;</span>&#125;,</span><br><span class="line">gogpt.ChatCompletionMessage&#123;Role: <span class="string">&quot;user&quot;</span>, Content: a&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := c.CreateChatCompletion(ctx, req)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;找不到了，喵&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> resp.Choices[<span class="number">0</span>].Message.Content</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合官网上的<a href="https://docs.go-cqhttp.org/reference/#%E9%80%9A%E4%BF%A1">通信介绍</a>我们可以知道，go-cqhttp 大概是一个中介，帮你整和了关于 qq 的 API ，然后他伪装成一个客户端登录 qq，之后你直接与他交流来操作这个账号</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304011125627.png" alt="image-20230401112542218"></p><p>同时他有两种通信方式，第一种是暴露好给你的 API 让你主动调用，比如说你想向某人发送一条消息，你的后端就去调用发送私聊消息这个接口，第二种是将收到的事件上报给你，比如说这个账号收到一条消息，会自动向你的后端发送发送请求，这两种方式具体传输的是哪些结构，请看官网上的 <a href="https://docs.go-cqhttp.org/api/">API</a> 和 <a href="https://docs.go-cqhttp.org/event/">Event</a> 文档</p><p>而这两种又都可以使用 http 或是 ws 进行通信，我不想折腾 ws ，下面就尝试使用 http 了</p><h2 id="本地测试">本地测试</h2><h3 id="启动-go-http">启动 go-http</h3><p>好了现在基本弄懂了是个什么流程，我们首先要尝试把 go-http 跑起来，我是直接 clone 下来然后 <code>go run main.go</code></p><p>需要注意的是两个配置文件：<code>config.yml</code> 和 <code>device.json</code> ，这两个一个是 go-http 的配置，一个是你要虚拟的客户端设备的配置</p><p>对于 <code>device.json</code> ，官网提供了几种设备协议</p><table><thead><tr><th>值</th><th>类型</th><th>限制</th></tr></thead><tbody><tr><td>0</td><td>Default/Unset</td><td>当前版本下默认为iPad</td></tr><tr><td>1</td><td>Android Phone</td><td>无</td></tr><tr><td>2</td><td>Android Watch</td><td>无法接收 <code>notify</code> 事件、无法接收口令红包、无法接收撤回消息</td></tr><tr><td>3</td><td>MacOS</td><td>无</td></tr><tr><td>4</td><td>企点</td><td>只能登录企点账号或企点子账号</td></tr><tr><td>5</td><td>iPad</td><td>无</td></tr><tr><td>6</td><td>aPad</td><td>无</td></tr></tbody></table><p>但是我实际尝试下来，目前只能用 <code>Android Watch</code> 扫码登录，其他方式都是不可以的</p><p>然后是 <code>config.yml</code> ，这里我将我的后端地址设定为 5701 来接受他上报的事件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">http:</span> <span class="comment"># HTTP 通信设置</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:5700</span> <span class="comment"># HTTP监听地址</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">20</span>      <span class="comment"># 反向 HTTP 超时时间, 单位秒，&lt;5 时将被忽略</span></span><br><span class="line">    <span class="attr">long-polling:</span>   <span class="comment"># 长轮询拓展</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span>       <span class="comment"># 是否开启</span></span><br><span class="line">      <span class="attr">max-queue-size:</span> <span class="number">2000</span> <span class="comment"># 消息队列大小，0 表示不限制队列大小，谨慎使用</span></span><br><span class="line">    <span class="attr">middlewares:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="string">*default</span> <span class="comment"># 引用默认中间件</span></span><br><span class="line">    <span class="attr">post:</span>           <span class="comment"># 反向HTTP POST地址列表</span></span><br><span class="line">      <span class="comment">#- url: &#x27;&#x27;                # 地址</span></span><br><span class="line">      <span class="comment">#  secret: &#x27;&#x27;             # 密钥</span></span><br><span class="line">      <span class="comment">#  max-retries: 3         # 最大重试，0 时禁用</span></span><br><span class="line">      <span class="comment">#  retries-interval: 1500 # 重试时间，单位毫秒，0 时立即</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">http://127.0.0.1:5701/</span> <span class="comment"># 地址</span></span><br><span class="line">        <span class="attr">secret:</span> <span class="string">&#x27;&#x27;</span>                  <span class="comment"># 密钥</span></span><br><span class="line">        <span class="attr">max-retries:</span> <span class="number">5</span>             <span class="comment"># 最大重试，0 时禁用</span></span><br><span class="line">        <span class="attr">retries-interval:</span> <span class="number">1000</span>      <span class="comment"># 重试时间，单位毫秒，0 时立即</span></span><br></pre></td></tr></table></figure><p>同时他默认是有一个心跳包的设计的，我感觉看着烦人就把它关掉了</p><h3 id="观察事件包">观察事件包</h3><p>关于事件他官网上是有定义的，但是我还是想先看看他会往我的后端发什么包，所以我就让 gpt 写了个打印请求内容的后端</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">body, err := ioutil.ReadAll(r.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="type">string</span>(body))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, values := <span class="keyword">range</span> r.Header &#123;</span><br><span class="line"><span class="comment">// 如果某个头部信息有多个值，则逐一打印出来</span></span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> values &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s: %s\n&quot;</span>, name, value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;:5701&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后获取的请求正文如下</p><div class="tabs" id="样例"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#样例-1">群消息</button></li><li class="tab"><button type="button" data-href="#样例-2">群at</button></li><li class="tab"><button type="button" data-href="#样例-3">私聊</button></li><li class="tab"><button type="button" data-href="#样例-4">心跳包</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="样例-1"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;post_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;group&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="number">1679735366</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;self_id&quot;</span><span class="punctuation">:</span> <span class="number">2165526145</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sub_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;normal&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_id&quot;</span><span class="punctuation">:</span> <span class="number">1388708604</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;anonymous&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;group_id&quot;</span><span class="punctuation">:</span> <span class="number">220164741</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_seq&quot;</span><span class="punctuation">:</span> <span class="number">3864</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;raw_message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你好👋&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;area&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;card&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NX&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;owner&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unknown&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;font&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你好👋&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="样例-2"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;post_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;group&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="number">1679735446</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;self_id&quot;</span><span class="punctuation">:</span> <span class="number">2165526145</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sub_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;normal&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;area&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;card&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NX&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;owner&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unknown&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;anonymous&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;font&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;group_id&quot;</span><span class="punctuation">:</span> <span class="number">220164741</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[CQ:at,qq=2165526145] 你好&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;raw_message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[CQ:at,qq=2165526145] 你好&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_seq&quot;</span><span class="punctuation">:</span> <span class="number">3865</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_id&quot;</span><span class="punctuation">:</span> <span class="number">633418346</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="样例-3"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;post_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;private&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="number">1679735201</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;self_id&quot;</span><span class="punctuation">:</span> <span class="number">2165526145</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sub_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;friend&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;font&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NX&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unknown&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message_id&quot;</span><span class="punctuation">:</span> <span class="number">-1953887271</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">976180942</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;target_id&quot;</span><span class="punctuation">:</span> <span class="number">2165526145</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你好&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;raw_message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你好&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="样例-4"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;post_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;meta_event&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;meta_event_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;heartbeat&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="number">1679736263</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;self_id&quot;</span><span class="punctuation">:</span> <span class="number">2165526145</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;app_enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;app_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;app_initialized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;online&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;plugins_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;stat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;packet_received&quot;</span><span class="punctuation">:</span> <span class="number">113</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;packet_sent&quot;</span><span class="punctuation">:</span> <span class="number">105</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;packet_lost&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;message_received&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;message_sent&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;disconnect_times&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lost_times&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;last_message_time&quot;</span><span class="punctuation">:</span> <span class="number">1679735446</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="测试-ChatGPT">测试 ChatGPT</h3><p>因为我们是要接入 ChatGPT 的，所以我们应该在本地测试一下这东西该怎么调用</p><p>还是用和 demo 相同的<a href="https://github.com/sashabaranov/go-openai">第三方 SDK</a> 好了</p><p>我还根据文档加了个保存上下文的功能</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/sashabaranov/go-openai&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> messages []openai.ChatCompletionMessage</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">client := openai.NewClient(<span class="string">&quot;your key here&quot;</span>)</span><br><span class="line"><span class="comment">// 从键盘输入</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">var</span> question <span class="type">string</span></span><br><span class="line">fmt.Scanln(&amp;question)</span><br><span class="line">fmt.Println(ChatGPT(question, client))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ChatGPT</span><span class="params">(question <span class="type">string</span>, client *openai.Client)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">messages = <span class="built_in">append</span>(messages, openai.ChatCompletionMessage&#123;</span><br><span class="line">Role:    openai.ChatMessageRoleUser,</span><br><span class="line">Content: question,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">resp, err := client.CreateChatCompletion(</span><br><span class="line">context.Background(),</span><br><span class="line">openai.ChatCompletionRequest&#123;</span><br><span class="line">Model:    openai.GPT3Dot5Turbo,</span><br><span class="line">Messages: messages,</span><br><span class="line">&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err.Error()</span><br><span class="line">&#125;</span><br><span class="line">content := resp.Choices[<span class="number">0</span>].Message.Content</span><br><span class="line">messages = <span class="built_in">append</span>(messages, openai.ChatCompletionMessage&#123;</span><br><span class="line">Role:    openai.ChatMessageRoleAssistant,</span><br><span class="line">Content: content,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>跑起来感觉没什么问题</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304011224788.png" alt="image-20230401122457755"></p><h3 id="编写后端">编写后端</h3><p>现在来编写后端了，考虑到可扩展性还有方便我还是选择了 go-zero</p><p>首先来定义接口，我只需要这几个字段就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;v1&quot;</span><br><span class="line"></span><br><span class="line">service app &#123;</span><br><span class="line">@handler Message</span><br><span class="line">post / (MessageRequest) returns (MessageReply)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type (</span><br><span class="line">MessageRequest &#123;</span><br><span class="line">PostType    string `json:&quot;post_type&quot;`</span><br><span class="line">MessageType string `json:&quot;message_type&quot;`</span><br><span class="line">Message     string `json:&quot;message&quot;`</span><br><span class="line">RawMessage  string `json:&quot;raw_message&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MessageReply &#123;</span><br><span class="line">Reply string `json:&quot;reply&quot;`</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>然后准备一下 gpt ，我本来是想做成有上下文的，但是这样聊不了几句就会超长度，还是改成没有上下文的先</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> gpt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;context&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/sashabaranov/go-openai&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> messages []openai.ChatCompletionMessage</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Chat</span><span class="params">(question <span class="type">string</span>, client *openai.Client)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//if question == &quot;新对话&quot; &#123;</span></span><br><span class="line"><span class="comment">//messages = nil</span></span><br><span class="line"><span class="comment">//return &quot;新对话已创建&quot;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//messages = append(messages, openai.ChatCompletionMessage&#123;</span></span><br><span class="line"><span class="comment">//Role:    openai.ChatMessageRoleUser,</span></span><br><span class="line"><span class="comment">//Content: question,</span></span><br><span class="line"><span class="comment">//&#125;)</span></span><br><span class="line"></span><br><span class="line">resp, err := client.CreateChatCompletion(</span><br><span class="line">context.Background(),</span><br><span class="line">openai.ChatCompletionRequest&#123;</span><br><span class="line">Model: openai.GPT3Dot5Turbo,</span><br><span class="line">Messages: []openai.ChatCompletionMessage&#123;</span><br><span class="line">&#123;</span><br><span class="line">Role:    openai.ChatMessageRoleUser,</span><br><span class="line">Content: question,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">messages = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">return</span> err.Error()</span><br><span class="line">&#125;</span><br><span class="line">content := resp.Choices[<span class="number">0</span>].Message.Content</span><br><span class="line"><span class="comment">//messages = append(messages, openai.ChatCompletionMessage&#123;</span></span><br><span class="line"><span class="comment">//Role:    openai.ChatMessageRoleAssistant,</span></span><br><span class="line"><span class="comment">//Content: content,</span></span><br><span class="line"><span class="comment">//&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后来编写调用逻辑，暂时偷懒把 qq 号写死了，毕竟也就是先测试一下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *MessageLogic)</span></span> Message(req *types.MessageRequest) (resp *types.MessageReply, err <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">trigger := <span class="string">&quot;[CQ:at,qq=2165526145] &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> req.PostType == <span class="string">&quot;message&quot;</span> &amp;&amp; req.MessageType == <span class="string">&quot;group&quot;</span> &amp;&amp; strings.HasPrefix(req.Message, trigger) &#123;</span><br><span class="line">l.Logger.Info(req)</span><br><span class="line">gptReply := gpt.Chat(strings.TrimPrefix(req.Message, trigger), l.svcCtx.GPTClient)</span><br><span class="line">l.Logger.Info(gptReply)</span><br><span class="line"><span class="keyword">return</span> &amp;types.MessageReply&#123;</span><br><span class="line">Reply: gptReply,</span><br><span class="line">&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一来就完成了，我本地测试起来是能正常工作的</p><h2 id="线上部署">线上部署</h2><p>下面就是把它部署到服务器上了，我本来是想用docker的，结果docker版本的死活启动不起来，最后麻了直接起两个screen运行二进制文件</p><p>但是登录的时候又遇到了问题，扫码之后腾讯居然不让我登录，据说是最近严格了还限制要同一网段（</p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304011417687.png" alt="F274063B-3370-4461-8BAD-67D0A5D85C7E" style="zoom: 25%;" /><p>我卡在这里有了一段时间，好在群友说可以把登录的产生的 token 和临时文件复制上去，然后就可以了</p><p>也就是同一目录下的 <code>session.token</code> 和 <code>data</code> 文件夹，就像这个视频里面的一样：<a href="https://www.bilibili.com/video/BV1Ux4y1F7cF">BV1Ux4y1F7cF</a></p><p>然后就可以开始你的奇思妙想了！</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202304011429976.png" alt="image-20230401142911920"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前看见过很多 qq 机器人的例子，比如把 ChatGPT 接进群里之类的，然后最近有点空闲，并且感觉宿舍群里也缺少一些自动化的建设，就打算上手做一个&lt;/p&gt;
&lt;p&gt;功能上的设计先别搞那么复杂，就先接个 ChatGPT 算了&lt;/p&gt;
&lt;p&gt;我就去问关于qq 机器人的最佳实践</summary>
      
    
    
    
    <category term="QQ Bot" scheme="https://www.nickxu.top/categories/QQ-Bot/"/>
    
    
    <category term="QQ bot" scheme="https://www.nickxu.top/tags/QQ-bot/"/>
    
  </entry>
  
  <entry>
    <title>告别ELK！轻量级日志收集系统Grafana Loki初上手</title>
    <link href="https://www.nickxu.top/2023/03/18/%E5%91%8A%E5%88%ABELK%EF%BC%81%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FGrafana-Loki%E5%88%9D%E4%B8%8A%E6%89%8B/"/>
    <id>https://www.nickxu.top/2023/03/18/%E5%91%8A%E5%88%ABELK%EF%BC%81%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FGrafana-Loki%E5%88%9D%E4%B8%8A%E6%89%8B/</id>
    <published>2023-03-18T13:10:56.000Z</published>
    <updated>2023-03-21T13:44:21.685Z</updated>
    
    <content type="html"><![CDATA[<p>关于日志收集，鄙人最早接触到的是 ELK 那一套（Elasticsearch、Logstash 和 Kibana），最近我青训营的项目也是<a href="https://hdu-help.feishu.cn/docx/KuGidErAIogvWDxcn2VcTrfUntb#part-R15Qdxms9o7RoQxlNDlcqc1Innd">差不多的架构</a>，但是这一套下来资源占用也太可怕了（特别是 Elasticsearch ，太重了）</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192126852.png" alt="image-20230319212648673"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192136627.png" alt="image-20230319213630597"></p><blockquote><p>go-zero 官方也说了，这一套不建议在小规模的服务上使用，而我一般的实际项目也没多大规模，根本用不上这么重的解决方案，所以我需要找一套更轻量的解决方案</p></blockquote><p><a href="https://www.v2ex.com/t/694094">翻了一圈</a>，感觉推荐 Grafana + Loki 的不少</p><p>然后我就跑去 <a href="https://grafana.com/docs/loki/latest/">Loki官方文档</a>了</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192203626.png" alt="image-20230319220344596"></p><blockquote><p>这是官方文档中的快速上手的架构图，为了让你感受它的可扩展性，就把内部的读写部分拆出来运行，其实不用这么复杂，直接一个单体也可以</p></blockquote><p>折腾了一圈，大概是这么个逻辑：首先是要有一个 Client（例如图中的 <strong>Promtail</strong> ）去拉取运行日志喂给 Loki ，然后 Loki 去读写 Storage（例如图中的 <strong>Minio</strong> ），那日志要怎么方便地查看呢？用 <strong>Grafana</strong> ，这东西界面做的真的很好看</p><p>为了让你快速理解与上手，我简化了一下官方 Demo，docker-compose 中只包含四个服务：</p><ul><li><p>产生日志的程序：和官方一样使用了 <a href="https://github.com/mingrammer/flog">flog</a> 来不停地向标准输出中放入假日志</p></li><li><p>Loki：用于打包日志、打标签等</p></li><li><p>Client：用于拉取日志交给 Loki，Loki 支持多种客户端，你可以在 <a href="https://grafana.com/docs/loki/latest/clients/#grafana-loki-clients">Grafana Loki clients</a> 中查看支持的所有客户端</p><p>我知道有一个 Docker Driver ，但是这东西要给 Docker 装插件，感觉有点麻烦，还是和官方例子一样使用了 Promtail</p></li><li><p>Storage：用于保存日志，你可以在 <a href="https://grafana.com/docs/loki/latest/storage/#storage">Storage</a> 中查看所有支持的存储介质，甚至存储为本地文件都行</p><p>这里和官方例子一样使用了兼容亚马逊 S3协议的 minio 作为存储介质</p></li><li><p>Grafana：用于提供一个好看的可视化界面</p></li></ul><p>先新建一个文件夹，进去创建三个文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- docker-compose.yaml</span><br><span class="line">|-- loki-config.yaml</span><br><span class="line">`-- promtail-config.yaml</span><br></pre></td></tr></table></figure><p><code>docker-compose.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">loki:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">loki:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:2.7.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">loki</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3100</span><span class="string">:3100</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./loki-config.yaml:/etc/loki/local-config.yaml</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-config.file=/etc/loki/local-config.yaml</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">promtail:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/promtail:2.7.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">promtail</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./promtail-config.yaml:/etc/promtail/promtail-config.yaml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span> <span class="comment"># 直接把本机的docker套接字映射进去，这样就可以直接抓取所有容器的日志了</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-config.file=/etc/promtail/promtail-config.yaml</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_PATHS_PROVISIONING=/etc/grafana/provisioning</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE=Admin</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3000</span><span class="string">:3000</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-config</span> <span class="string">/etc/grafana/grafana.ini</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-euc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        mkdir -p /data/loki-data &amp;&amp; \</span></span><br><span class="line"><span class="string">        mkdir -p /data/loki-ruler &amp;&amp; \</span></span><br><span class="line"><span class="string">        minio server /data</span></span><br><span class="line"><span class="string"></span>    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_ACCESS_KEY=loki</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_SECRET_KEY=supersecret</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_PROMETHEUS_AUTH_TYPE=public</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MINIO_UPDATE=off</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.data/minio:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">flog:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mingrammer/flog</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">flog</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-f</span> <span class="string">json</span> <span class="string">-d</span> <span class="string">1s</span> <span class="string">-l</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>loki-config.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">auth_enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">http_listen_port:</span> <span class="number">3100</span></span><br><span class="line"><span class="attr">memberlist:</span></span><br><span class="line">  <span class="attr">join_members:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">loki:7946</span></span><br><span class="line"><span class="attr">schema_config:</span></span><br><span class="line">  <span class="attr">configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">from:</span> <span class="number">2021-08-01</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">boltdb-shipper</span></span><br><span class="line">      <span class="attr">object_store:</span> <span class="string">s3</span></span><br><span class="line">      <span class="attr">schema:</span> <span class="string">v11</span></span><br><span class="line">      <span class="attr">index:</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">index_</span></span><br><span class="line">        <span class="attr">period:</span> <span class="string">24h</span></span><br><span class="line"><span class="attr">common:</span></span><br><span class="line">  <span class="attr">path_prefix:</span> <span class="string">/loki</span></span><br><span class="line">  <span class="attr">replication_factor:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">storage:</span></span><br><span class="line">    <span class="attr">s3:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">http://minio:9000</span></span><br><span class="line">      <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">bucketnames:</span> <span class="string">loki-data</span></span><br><span class="line">      <span class="attr">access_key_id:</span> <span class="string">loki</span></span><br><span class="line">      <span class="attr">secret_access_key:</span> <span class="string">supersecret</span></span><br><span class="line">      <span class="attr">s3forcepathstyle:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ring:</span></span><br><span class="line">    <span class="attr">kvstore:</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">memberlist</span></span><br><span class="line"><span class="attr">ruler:</span></span><br><span class="line">  <span class="attr">storage:</span></span><br><span class="line">    <span class="attr">s3:</span></span><br><span class="line">      <span class="attr">bucketnames:</span> <span class="string">loki-ruler</span></span><br></pre></td></tr></table></figure><p><code>promtail-config.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">http_listen_port:</span> <span class="number">9080</span></span><br><span class="line">  <span class="attr">grpc_listen_port:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">positions:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">/tmp/positions.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">clients:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">http://loki:3100/loki/api/v1/push</span></span><br><span class="line">    <span class="attr">tenant_id:</span> <span class="string">tenant1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">flog_scrape</span> </span><br><span class="line">    <span class="attr">docker_sd_configs:</span> <span class="comment"># 对于promtail来说，又可以定义各种日志来源，请见 https://grafana.com/docs/loki/latest/clients/promtail/configuration/#scrape_configs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">unix:///var/run/docker.sock</span> <span class="comment"># 这里直接从docker套接字拿日志</span></span><br><span class="line">        <span class="attr">refresh_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">relabel_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">&#x27;__meta_docker_container_name&#x27;</span>] <span class="comment"># 根据容器名打标签分类</span></span><br><span class="line">        <span class="attr">regex:</span> <span class="string">&#x27;/(.*)&#x27;</span></span><br><span class="line">        <span class="attr">target_label:</span> <span class="string">&#x27;container&#x27;</span> <span class="comment"># 标签名为 container</span></span><br></pre></td></tr></table></figure><p>准备好了之后，运行 docker-compose 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><p>然后来到 <a href="http://127.0.0.1:3000/">127.0.0.1:3000</a> 进入Grafana</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192242367.png" alt="image-20230319224216330"></p><p>点击左下角添加数据源，选择 Loki</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192243339.png" alt="image-20230319224322305"></p><p>URL填写为 <code>http://loki:3100</code></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192244031.png" alt="image-20230319224436992"></p><p>再来到 Explore，选择要看的容器为 flog</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192244370.png" alt="image-20230319224456334"></p><p>它居然会自动提示你添加 JSON 解析</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192246491.png" alt="image-20230319224653449"></p><p>然后你就可以根据字段添加检索条件了，比方说状态码限定为 200</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303192247842.png" alt="image-20230319224734800"></p><p>我只能说简直不要太舒服了</p><p>接下来你就可以把这一套放在你的项目里面了，你可以监听某个容器，或者监听某个日志文件，又或者监听某个卡夫卡队列，都可以，随便你折腾了</p><p>（PS：你的容器不能启用 <code>tty</code>  <a href="https://github.com/grafana/loki/issues/5950#issuecomment-1223979118%EF%BC%89">https://github.com/grafana/loki/issues/5950#issuecomment-1223979118）</a></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303201236992.png" alt="image-20230320123644774"></p><p>最后来看看资源占用，内存 200MB 左右，相对来说轻量了不少</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;关于日志收集，鄙人最早接触到的是 ELK 那一套（Elasticsearch、Logstash 和 Kibana），最近我青训营的项目也是&lt;a href=&quot;https://hdu-help.feishu.cn/docx/KuGidErAIogvWDxcn2VcTrfUntb</summary>
      
    
    
    
    <category term="运维" scheme="https://www.nickxu.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="日志收集" scheme="https://www.nickxu.top/categories/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
    <category term="运维" scheme="https://www.nickxu.top/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>亚运赛会志愿者通用培训</title>
    <link href="https://www.nickxu.top/2023/03/18/%E4%BA%9A%E8%BF%90%E8%B5%9B%E4%BC%9A%E5%BF%97%E6%84%BF%E8%80%85%E9%80%9A%E7%94%A8%E5%9F%B9%E8%AE%AD/"/>
    <id>https://www.nickxu.top/2023/03/18/%E4%BA%9A%E8%BF%90%E8%B5%9B%E4%BC%9A%E5%BF%97%E6%84%BF%E8%80%85%E9%80%9A%E7%94%A8%E5%9F%B9%E8%AE%AD/</id>
    <published>2023-03-18T03:06:57.000Z</published>
    <updated>2023-03-20T05:07:39.800Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303181107743.png" alt="26B3608C-8FD3-41BB-8D99-858BB38BA514"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303201307475.png" alt="image-20230320130701406"></p><hr><h1 id="杭州亚运会及赛会志愿服务概述">杭州亚运会及赛会志愿服务概述</h1><p>志愿者含义</p><ul><li>自愿</li><li>不谋物质报酬</li><li>服务于社会公益</li><li>奉献力所能及</li><li>非本职工作</li></ul><p>中国青年志愿者精神</p><ul><li>奉献</li><li>友爱</li><li>互助</li><li>进步</li></ul><p>志愿者基本行为规范</p><ul><li>三会<ol><li>会站</li><li>会笑（难）</li><li>会说</li></ol></li><li>三知<ol><li>知道自己的位置</li><li>知道别人问的位置</li><li>知道卫生间、医疗点、AED及安全出口</li></ol></li><li>三救<ol><li>自救（包括不要泄露联系方式给任何人</li><li>施救</li><li>向谁求助</li></ol></li><li>三受<ol><li>受苦</li><li>受累</li><li>受委屈</li></ol></li><li>五定<ol><li>定人</li><li>定岗</li><li>定时</li><li>定事</li><li>定责</li></ol></li></ul><p>熟记亚运会标志以及吉祥物（略</p><p>志愿者口号：来吧，朋友（friends unite！）</p><p>志愿者之歌：等你来</p><p>岗位服务能力要求</p><p>语言沟通能力</p><p>合作能力</p><p>应变能力</p><hr><h1 id="志愿服务通用礼仪">志愿服务通用礼仪</h1><h2 id="基本原则"><strong>基本原则</strong></h2><ul><li>平等</li><li>尊重</li><li>宽容</li><li>适度</li><li>自律</li></ul><h2 id="形象塑造"><strong>形象塑造</strong></h2><ul><li><p>头发 男：前不覆额 后不触领 侧不掩耳 女：前不遮眉 发不披散 过肩盘起</p></li><li><p>面部 五官</p></li><li><p>肢体</p></li><li><p>统一着装</p></li><li><p>着装整洁</p></li><li><p>配饰要求</p></li></ul><h2 id="礼仪规范"><strong>礼仪规范</strong></h2><ul><li>站 抬头挺胸</li><li>坐 二分之一 左进左出</li><li>走 成行成列</li><li>蹲 高低式 半跪式 交叉式</li></ul><p>三方介绍：尊者优先</p><p>引领：走路上下楼梯电梯出入口（略）</p><h2 id="文明用语"><strong>文明用语</strong></h2><p>不要说：不归我管 不知道不会</p><p>该说不的时候要说不</p><hr><h1 id="上岗要求及纪律规范">上岗要求及纪律规范</h1><h2 id="岗前准备">岗前准备</h2><ul><li><p>吃苦受累</p></li><li></li><li><p>岗位差异</p></li><li><p>遭受委屈</p></li><li><p>熟悉工作内容及周边环境</p></li><li><p>赛事安排及有关信息（赛事、城市）</p></li><li><p>突发事件应对处理</p></li><li><p>专业技能准备</p></li><li><p>说话做事符合礼仪要求</p></li><li><p>做好体能准备</p></li></ul><h2 id="基本要求">基本要求</h2><h3 id="业务操作能力">业务操作能力</h3><ul><li>遵守防疫要求</li><li>坚守工作岗位</li><li>认真履行职责（尽职尽责、通讯畅通、首问负责对口接待</li><li>转换期适应调整</li><li>团队意识</li><li>汇报总结</li></ul><h3 id="礼仪应用能力">礼仪应用能力</h3><ul><li>统一着装</li><li>基本原则：平等适度承诺惯例</li><li>礼仪规范（略</li></ul><h3 id="沟通力">沟通力</h3><p>略</p><h3 id="创造力">创造力</h3><h3 id="感知力">感知力</h3><h3 id="变通力">变通力</h3><h2 id="重要制度">重要制度</h2><ul><li><p>考勤制度</p></li><li><p>请假制度</p></li><li><p>会议制度</p></li><li><p>宣传制度</p></li><li><p>舆情报送制度</p></li><li><p>激励制度</p></li><li><p>督查制度</p></li></ul><h2 id="15不纪律要求">15不纪律要求</h2><ol><li>危害国家安全和利益</li><li>泄漏工作秘密</li><li>泄露隐私</li><li>违法着装和形象纪律</li><li>迟到早退</li><li>出借服装证件</li><li>宗教活动</li><li>接触看惯他人钱物</li><li>小费、商业行为</li><li>利用工作之便获取个人利益</li><li>擅自散播信息</li><li>擅自接受媒体采访</li><li>违法岗位安排</li><li>超出区域</li><li>违反防疫要求</li></ol><h2 id="纪律要求">纪律要求</h2><p>略</p><h2 id="违规处理办法">违规处理办法</h2><p>略</p><hr><h1 id="亚运助残志愿服务知识与技能">亚运助残志愿服务知识与技能</h1><h2 id="杭州亚残运会概况">杭州亚残运会概况</h2><p>略</p><h2 id="助残志愿服务须知">助残志愿服务须知</h2><p>残障人士的共性心理特点</p><ul><li>孤独</li><li>自卑</li><li>敏感猜疑</li><li>情绪强且不稳定</li><li>抱怨心理突出</li><li>富有同情心</li></ul><p>基本原则</p><ul><li>平等尊重</li><li>热情勤快</li><li>帮助适当</li></ul><p>服务理念</p><ol><li>理解需求</li><li>尊重个性</li><li>注重细节</li></ol><p>注意事项</p><ul><li>用词禁忌</li><li>眼神禁忌</li><li>四不：不看残障部位、不问原因、不碰辅助用具、不议论惊讶好奇</li></ul><h2 id="助残志愿服务基本技能">助残志愿服务基本技能</h2><h3 id="视力障碍者">视力障碍者</h3><p>视力障碍者的心理特点</p><ul><li>心理特殊</li><li>听觉突出</li><li>封闭自我</li></ul><p>基本礼仪</p><ol><li><p>交谈前：1-2米，有声音提示、语音平和</p><p>离开时：告知对方</p></li><li><p>初次相识：尽量多地告知自己的信息</p></li><li><p>指挥方位：以对方左右为方位</p></li><li><p>让其跟着走，不要拽着走，做他的眼睛不要做他的手</p></li><li><p>切忌窃窃私语或互相用手势交流</p></li><li><p>用餐：公筷夹到盘中、报菜名</p></li><li><p>不要过度代劳</p></li><li><p>不要领到河沟边、井盖边和车流量大等地方，要帮助回避障碍物</p></li><li><p>不要改变使用物品等摆放位置</p></li></ol><p>技巧</p><p><s>自己看视频（bushi</s></p><h3 id="肢体残障者">肢体残障者</h3><p>心理特点</p><ul><li>有独立性又有依赖性</li><li>不喜欢他人过多责备感染或控制</li><li>不得不依靠他人帮助来解决力不从心的实际问题</li></ul><p>基本礼仪</p><ol><li>不得过多关注残障部位</li><li>与轮椅者交谈：蹲姿</li><li>熟悉轮椅和无障碍环境</li></ol><p>对轮椅使用者：</p><ul><li>腿部和腰发力</li><li>不要急停急起</li><li>电梯要倒着进正着出</li></ul><p><s>又一个视频</s></p><h3 id="心智障碍者">心智障碍者</h3><ol><li>情感行为障碍</li><li>交流意愿、对他人的关系程度低</li><li>语言障碍</li></ol><p>基本礼仪（略</p><p>技巧</p><ul><li>速度要慢</li><li>…</li></ul><h3 id="听力残障者">听力残障者</h3><p>基本礼仪</p><ol><li>微笑用手语问好</li><li>注意手语准确性和表情配合</li></ol><p>技巧</p><ol><li>随身携带纸笔</li></ol><p><s>又一个视频</s></p><h2 id="比赛中的特殊帮助">比赛中的特殊帮助</h2><p>略</p><h2 id="无障碍环境与无障碍设施类别">无障碍环境与无障碍设施类别</h2><p>又一个视频</p><p>无障碍环境概念</p><ul><li>物质环境无障碍</li><li>信息获取无障碍</li></ul><h2 id="亚运会观众引导志愿者须知">亚运会观众引导志愿者须知</h2><p>略</p><hr><h1 id="大型赛会志愿者服务应急事件应对与自我保护">大型赛会志愿者服务应急事件应对与自我保护</h1><h2 id="事件分类及应对原则">事件分类及应对原则</h2><p>分类</p><ul><li>A级：火灾踩踏。组委会处理</li><li>B级：负面舆论、志愿者无法按时用餐等。场馆负责人或主任负责</li><li>C级：志愿者受伤。带队老师处理</li></ul><p>应对原则</p><ul><li><strong>确保安全</strong></li><li><strong>迅速上报</strong></li><li>合理应对</li><li>积极转化</li><li>预防监督</li></ul><h2 id="自我保护">自我保护</h2><p>不适宜志愿者的工作</p><ul><li>志愿者应扮演协助角色</li><li>不承担重大管理责任、安全责任财务责任、重体力劳动、需要专门劳动技能或劳动保护等工作</li></ul><p>主要内容</p><ul><li>防疫</li><li>环境和设施</li><li>交往</li><li>财务</li></ul><h3 id="防疫">防疫</h3><p>略</p><h3 id="环境和设施">环境和设施</h3><ul><li>保证人身周边环境安全</li><li>熟记安全出口消防栓等位置</li></ul><h3 id="交往安全">交往安全</h3><ul><li>不得单独进入服务对象的卧室或更衣室</li><li>尽量不要单独相处</li><li>不得超出服务范围服务</li></ul><h3 id="财务安全">财务安全</h3><ul><li><p>现场服务期间尽量少带东西，容易混淆的物品应做好个人标识</p></li><li><p>上下车东西带齐</p></li></ul><h2 id="常见应急事件处理">常见应急事件处理</h2><h3 id="工作环境产生的问题">工作环境产生的问题</h3><ul><li>天气恶劣</li><li>服务环境差</li><li>电梯故障</li></ul><h3 id="自身遇到的问题">自身遇到的问题</h3><ul><li>身体不适</li><li>意外伤害</li><li>家庭变故</li></ul><p>任何异常及时汇报</p><h3 id="服务对象产生的问题">服务对象产生的问题</h3><ul><li>不听从指挥及骚扰志愿者：耐心劝说、确保自身安全、向业务领域工作人员求助</li><li>服务对象拿出不当宣传资料：确保自身安全的情况下，可迅速收取，别理论</li><li>服务对象受伤：及时协助联系上报，情况危急且有一定能力可以协助处置</li><li>志愿者与服务对象发生冲突：不得发生语言和肢体冲突，把自己人带离服务区域，不要拍视频</li></ul><h3 id="后勤保障产生的问题">后勤保障产生的问题</h3><ul><li>车辆无法达到</li><li>用餐无法按时保证</li></ul><p>找老师就是了</p><h2 id="重大安全事件">重大安全事件</h2><p>A级事件</p><ul><li>交通事故</li><li>触电事故</li><li>火灾事故</li><li>建筑坍塌</li><li>社会安全事件</li></ul><hr><h1 id="急救知识与技能">急救知识与技能</h1><h2 id="心肺复苏术（CPR）">心肺复苏术（CPR）</h2><h3 id="识别心脏骤停">识别心脏骤停</h3><ul><li>无反应意识</li><li>无呼吸或仅有喘息样呼吸</li><li>无脉搏（由专业人员检查）</li></ul><h3 id="工作流程">工作流程</h3><p>观察环境-判断意识-反转体位-判断呼吸-呼救求援-胸外按压（C）-打开气道（A）-人工呼吸（B）-尽早AED除颤</p><p>由于气道梗阻顺序是ABC（溺水、婴儿、严重气道梗阻）</p><ol><li><p>观察环境</p></li><li><p>意识判断</p><p>轻拍重喊，拍肩膀，两侧耳朵喊</p><p>婴儿用手指轻弹足底</p></li><li><p>反转体位：一手保护头颈，另一只手插入对侧腋下，缓慢翻转成仰卧位</p></li><li><p>判断呼吸</p><p>在头部上方“听、看、感觉”约10秒（默念1001，1002，1003…</p></li><li><p>呼救求援</p><ul><li>指定专人做事</li></ul></li><li><p>胸外按压（C）</p><p>手法：一手掌根紧贴胸壁，双手食指相扣，掌根重叠，掌心翘起</p><p>成人（8岁以上）按压要领：</p><ul><li>位置：胸部正中，两乳头连线水平，即胸骨的下半部</li><li>深度：5-6cm</li><li>频率：100-120次/分钟</li><li>每次按压后放松使胸廓恢复到按压位置</li><li>计数（01，02，03…</li></ul></li><li><p>打开气道（A）</p><p>清理口腔异物、仰头举颌</p></li><li><p>人工呼吸（B）</p><ul><li>平静呼吸</li><li>避免过度通气</li><li>吹气时间约1秒，连续吹气2次</li><li>吹气同时看胸廓，确保通气时胸廓隆起</li><li>胸外按压与人工呼吸比例：30:2</li></ul></li></ol><ul><li>停止心肺复苏：活了/医务人员来了</li></ul><h2 id="自动体外除颤仪（AED）">自动体外除颤仪（AED）</h2><ul><li>电极片与皮肤紧贴</li><li>听从语言提示</li></ul><h2 id="鼻出血的现场处理">鼻出血的现场处理</h2><p>低头，用拇指食指紧捏鼻翼5-10分钟</p><p>严重的去医院</p><h2 id="扭伤的现场处理">扭伤的现场处理</h2><p>RICE原则</p><ul><li>R：休息</li><li>I：固定</li><li>C：冷敷</li><li>E：太高伤肢</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303181107743.png&quot; alt=&quot;26B3608C-8FD3-41BB-8D99-858BB38BA514&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img sr</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>离散数学2期末复习</title>
    <link href="https://www.nickxu.top/2023/03/16/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A62%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/"/>
    <id>https://www.nickxu.top/2023/03/16/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A62%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/</id>
    <published>2023-03-16T01:39:37.000Z</published>
    <updated>2023-03-16T01:44:09.317Z</updated>
    
    <content type="html"><![CDATA[<h1 id="函数">函数</h1><h2 id="u-函数及其性质的判断、函数值、像、原像等的计算-u"><u>函数及其性质的判断、函数值、像、原像等的计算</u></h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939444.png" alt="image-20230313165348791"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939574.png" alt="image-20230313165415391"></p><ul><li><p>满射：subjective</p></li><li><p>单射：ingective</p></li><li><p>双射：bijective</p></li><li><p>像是函数值的集合</p></li></ul><h2 id="u-函数的复合及反函数-u"><u>函数的复合及反函数</u></h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939649.png" alt="image-20230313165621655"></p><p>顺序不要反了</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939746.png" alt="image-20230313165635438"></p><h2 id="集合基数的概念">集合基数的概念</h2><p>略</p><h1 id="图">图</h1><ul><li>阶：顶点数</li><li>度：顶点作为端点的次数</li><li>零图：一条边都没有的图</li><li>平凡图：只有一个点的图</li></ul><h2 id="握手定理">握手定理</h2><ul><li>度数之和等于边数的两倍 $ l = 2m$</li><li>入度之和=出度之和=边数</li><li>奇度顶点的个数是偶数</li></ul><h2 id="可图化条件">可图化条件</h2><ol><li>度数之和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 为偶数</li><li>最大度小于等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> （你一个点最多也就把其他点连一遍）</li></ol><h2 id="无向完全图">无向完全图</h2><ul><li>每个点都与剩余点连接，记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">K_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> （ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 为阶数）</li><li>边点条数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>n</mi><mrow><mo fence="true">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo fence="true">)</mo></mrow></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{n\left( n-1\right) }{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li></ul><h2 id="图的连通性">图的连通性</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939837.png" alt="image-20230315201908204"></p><h2 id="图的矩阵表示">图的矩阵表示</h2><h3 id="关联矩阵">关联矩阵</h3><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939962.png" alt="image-20230315202212716"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939046.png" alt="image-20230315202315433"></p><h3 id="邻接矩阵">邻接矩阵</h3><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939134.png" alt="image-20230315202425046"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939205.png" alt="image-20230315202734790"></p><h3 id="可达矩阵">可达矩阵</h3><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939292.png" alt="image-20230315202839939"></p><h2 id="Dj">Dj</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939350.png" alt="image-20230315220820080"></p><h1 id="树">树</h1><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m=n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939495.png" alt="image-20230315221032295"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939664.png" alt="image-20230315222128741"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939808.png" alt="image-20230315222542989"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939861.png" alt="image-20230315222835667"></p><ul><li>中序：左中右</li><li>前序：中左右</li><li>后续：左右中</li></ul><h1 id="几种特殊的图">几种特殊的图</h1><h2 id="欧拉图">欧拉图</h2><p>通过所有边一次</p><ul><li>无向图充要：连通无奇度</li><li>有向图充要：强连通、每个点入度等于出度</li></ul><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939948.png" alt="image-20230315203012419"></p><h2 id="哈密顿图">哈密顿图</h2><p>通过所有点一次</p><p>注意是充分条件不是充要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo fence="true">(</mo><mi>u</mi><mo fence="true">)</mo></mrow><mo>+</mo><mi>d</mi><mrow><mo fence="true">(</mo><mi>v</mi><mo fence="true">)</mo></mrow><mo>≥</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d\left( u\right) +d\left( v\right) \geq n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">u</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939020.png" alt="image-20230315203547959"></p><h2 id="二部图与平面图">二部图与平面图</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939207.png" alt="image-20230315223131877"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939404.png" alt="image-20230315223346420"></p><ul><li>欧拉公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi><mo>+</mo><mi>r</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n-m+r=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></li><li>面数之和等于边数两倍</li></ul><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939762.png" alt="image-20230315223635830"></p><ul><li>平面图的必要：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>≤</mo><mn>3</mn><mi>n</mi><mo>−</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">m\leq 3n-6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span></li></ul><h1 id="基本的组合计数公式">基本的组合计数公式</h1><ol><li><p>排列公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>A</mi><mi>n</mi><mi>k</mi></msubsup><mo>=</mo><mfrac><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">A_n^k=\frac{n!}{(n-k)!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4001em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mclose mtight">!</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，表示从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个不同的元素中选出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个元素进行排列的方案数。</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 开始往后递减相乘 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个数</p></li><li><p>组合公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mi>n</mi><mi>k</mi></msubsup><mo>=</mo><mfrac><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><mrow><mi>k</mi><mo stretchy="false">!</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">C_n^k=\frac{n!}{k!(n-k)!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4001em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">!</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mclose mtight">!</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，表示从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个不同的元素中选出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个元素进行组合的方案数。</p></li><li><p>重复排列公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">n^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>，表示从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个不同的元素中选出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个元素进行重复排列的方案数。</p></li><li><p>重复组合公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>n</mi><mo>+</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">C_{n+k-1}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1905em;vertical-align:-0.3414em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.4169em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3414em;"><span></span></span></span></span></span></span></span></span></span>，表示从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 个不同的元素中选出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个元素进行重复组合的方案数。</p></li></ol><ul><li>二项式定理 $$(x+y)^n=\sum_{k=0}^n {n\choose k}x^ky^{n-k}$$</li></ul><h1 id="递推方程、生成函数及应用">递推方程、生成函数及应用</h1><h2 id="递推方程">递推方程</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939810.jpg" alt="image-20230316090850449"></p><p>具体来说，假设方程的一般形式为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>b</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi><mi>x</mi><mo>+</mo><mi>d</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ax^3+bx^2+cx+d=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">b</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，其导数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>3</mn><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">f&#x27;(x)=3ax^2+2bx+c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal">b</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>。如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f&#x27;(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 的根与原方程的一个根相同，则说明这个根是重根。</p><p>更具体地，可以使用以下的判断方法：</p><ol><li>求出方程的三个根 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">x_1,x_2,x_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</li><li>求出方程的导数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f&#x27;(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>。</li><li>求出导数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f&#x27;(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 的两个根 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">y_1,y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</li><li>判断 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">y_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是否等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，或者判断 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是否等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">x_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。如果有任意一个条件成立，则说明方程有重根。</li></ol><p>需要注意的是，如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f&#x27;(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 的两个根都与方程的某个根相同，则这个根是二重根；如果有三个根都相同，则这个根是三重根。</p><h2 id="生成函数">生成函数</h2><p>直接放弃</p><h1 id="代数系统">代数系统</h1><ul><li>交换 Commutative</li><li>结合 Assciative</li><li>幂等 Idempotent</li><li>幺元 Identity</li><li>零元 Zero element</li><li>逆元 Inverse element</li></ul><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939900.png" alt="image-20230315174627203"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939047.png" alt="image-20230315173528440"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939230.png" alt="image-20230315174640779"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939376.png" alt="image-20230315174702778"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303160939483.png" alt="image-20230315173735395"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;函数&quot;&gt;函数&lt;/h1&gt;
&lt;h2 id=&quot;u-函数及其性质的判断、函数值、像、原像等的计算-u&quot;&gt;&lt;u&gt;函数及其性质的判断、函数值、像、原像等的计算&lt;/u&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://pic-go-img.oss-cn-hangzhou.a</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>大二下宿舍上海一日游游记</title>
    <link href="https://www.nickxu.top/2023/03/13/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E5%AE%BF%E8%88%8D%E4%B8%8A%E6%B5%B7%E4%B8%80%E6%97%A5%E6%B8%B8%E6%B8%B8%E8%AE%B0/"/>
    <id>https://www.nickxu.top/2023/03/13/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E5%AE%BF%E8%88%8D%E4%B8%8A%E6%B5%B7%E4%B8%80%E6%97%A5%E6%B8%B8%E6%B8%B8%E8%AE%B0/</id>
    <published>2023-03-13T08:26:09.000Z</published>
    <updated>2023-03-24T03:09:56.439Z</updated>
    
    <content type="html"><![CDATA[<p>这篇因为时间拖太久了没写，就感觉没有当时的感觉了</p><p>现在只能说把朋友圈 copy 一下了，本来想详细讲讲的（</p><blockquote><p>讲真周末去长三角周边城市不比在下沙玩舒服？早上花一个小时坐高铁到上海虹桥，然后沿着10号线一路玩<br>上午到中共一大纪念馆，中午吃个饭，继续坐地铁到豫园，顺便还有城隍庙可以逛一下，接着去南京步行街一路逛吃，晚上逛到外滩正好看夜景，最后原路返回坐高铁回杭州，懂不懂国际性大都市的含金量哇🤣</p></blockquote><div class="fj-gallery"><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241108463.png" alt="image-20230324110835972"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241108172.png" alt="image-20230324110847152"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241108898.png" alt="image-20230324110851874"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241108429.png" alt="image-20230324110857406"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241109812.png" alt="image-20230324110915794"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241109336.png" alt="image-20230324110925318"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241109416.png" alt="image-20230324110933398"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241109513.png" alt="image-20230324110944495"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303241109287.png" alt="image-20230324110953266"></p>          </div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这篇因为时间拖太久了没写，就感觉没有当时的感觉了&lt;/p&gt;
&lt;p&gt;现在只能说把朋友圈 copy 一下了，本来想详细讲讲的（&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;讲真周末去长三角周边城市不比在下沙玩舒服？早上花一个小时坐高铁到上海虹桥，然后沿着10号线一路玩&lt;br&gt;
上午到</summary>
      
    
    
    
    <category term="随笔与总结" scheme="https://www.nickxu.top/categories/%E9%9A%8F%E7%AC%94%E4%B8%8E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="旅游" scheme="https://www.nickxu.top/tags/%E6%97%85%E6%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>一行命令打包 Docker Compose 中的镜像</title>
    <link href="https://www.nickxu.top/2023/03/13/%E4%B8%80%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%93%E5%8C%85docker-compose%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F/"/>
    <id>https://www.nickxu.top/2023/03/13/%E4%B8%80%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%93%E5%8C%85docker-compose%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F/</id>
    <published>2023-03-13T08:25:08.000Z</published>
    <updated>2023-03-21T16:12:40.123Z</updated>
    
    <content type="html"><![CDATA[<p>最近要在一个离线服务器上运行一个 docker-compose ，但是因为是离线嘛，镜像一个一个打包太麻烦了，就找到了下面这个命令，在一个有网的环境先打包整个 docker-compose 里的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker save -o docker-images.tar $(docker-compose config | awk <span class="string">&#x27;&#123;if ($1 == &quot;image:&quot;) print $2;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然后再把文件传输过去，读取的时候就用这个命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker load -i docker-images.tar</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近要在一个离线服务器上运行一个 docker-compose ，但是因为是离线嘛，镜像一个一个打包太麻烦了，就找到了下面这个命令，在一个有网的环境先打包整个 docker-compose 里的镜像&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t</summary>
      
    
    
    
    
    <category term="docker" scheme="https://www.nickxu.top/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>第五届字节跳动青训营项目总结</title>
    <link href="https://www.nickxu.top/2023/03/13/%E7%AC%AC%E4%BA%94%E5%B1%8A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E9%9D%92%E8%AE%AD%E8%90%A5%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
    <id>https://www.nickxu.top/2023/03/13/%E7%AC%AC%E4%BA%94%E5%B1%8A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E9%9D%92%E8%AE%AD%E8%90%A5%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/</id>
    <published>2023-03-13T08:24:18.000Z</published>
    <updated>2023-03-22T08:54:26.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>PS：以后写感想类博客一定要当天冲完，不然拖个一个星期真的找不到那种劲了</p></blockquote><p>首先我真的想向字节跳动和掘金社区道个歉，这次青训营我主要就是奔着大项目来的 <s>，平时的课基本没怎么听</s></p><p>关于课的话，其实是挺好的，但是和第三届的重复了很多，加之一开始结营条件定的太高了，考虑到寒假的精力，我选择直接放弃结营证书，全力去冲项目证书了 <s>（结果最后告诉我没有实体的项目证书）</s></p><p>好了，回到正题，关于这次的项目总结，关于项目的过程在我的 <a href="https://www.nickxu.top/2023/03/01/%E5%86%99%E5%9C%A8%E5%A4%A7%E4%BA%8C%E5%BC%80%E5%AD%A6%E4%B9%8B%E5%88%9D/#%E9%9D%92%E8%AE%AD%E8%90%A5%E7%A0%B4%E9%98%B2">写在大二开学之初</a> 其实已经有所记录了，这一篇再稍微简单补充一下</p><hr><h2 id="答辩成绩">答辩成绩</h2><p>作为 h68u 队的队长，这次项目能取得这么好的成绩绝对是在我的意料之外的，我一个双非本科非计算机专业的大二学生，居然能带领团队拿到第一的名次，这我真的想都不敢想</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303182106439.png" alt="image-20230318210642346"></p><blockquote><p>当我第一次看见这个名次的时候，我是愣住的</p></blockquote><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303182107112.png" alt="image-20230318210714092"></p><blockquote><p>答辩时与评委的对话，我从未想过能得到评委这么高的肯定</p></blockquote><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303221653073.png" alt="img" style="zoom: 25%;" /><blockquote><p>最后的电子版证书</p></blockquote><hr><h2 id="开发过程">开发过程</h2><blockquote><p>项目地址：<a href="https://github.com/h68u/h68u-tiktok-app-microservice">https://github.com/h68u/h68u-tiktok-app-microservice</a></p><p>项目文档：<a href="https://hdu-help.feishu.cn/docx/KuGidErAIogvWDxcn2VcTrfUntb">https://hdu-help.feishu.cn/docx/KuGidErAIogvWDxcn2VcTrfUntb</a></p></blockquote><p>当公布大项目的题目和第三届的一样时，我心里差不多就有个框架了，毕竟有第三届的项目可以参考，这个项目可以很好的锻炼一下社团里面的新人，然后最后让我来收尾做一些优化（我一开始真的是这么计划的</p><p>项目框架选的是 go-zero ，一方面我在微服务方面暂时也就比较熟悉这个，而且也挺好用的，另一方面我有其他项目也在用这个框架，但是我也不知道我写的是个什么水平，于是就想用相同的框架开发，然后让评委点评一下，看看自己怎么样</p><p>我本来计划的是春节前把基本业务都实现好，然后后面开始优化，但是实际上你们也都看见了，没办法，到头来基本还是得靠自己</p><p>于是真的是苦了自己，那段时间真的是连轴转，到后面时间真的很赶，到农历十几号才让所有接口都能正常工作</p><p>然后就是优化了，缓存是肯定要上的，但是 Redis 我之前也不是很熟，也没用过（上次项目的缓存不是我写的），但是没办法你肯定要逼着自己学，我就去看上次的项目怎么写的，然后看了一堆文章，又去和 GPT 聊了很久，我再开始写缓存</p><p>但是维护缓存的一致性又可以牵扯到消息队列，我想尽量让我的项目高大上一些（这个项目大概是我一年来对于后端的全部理解），我就又去学消息队列怎么用，不得不说 <a href="https://github.com/hibiken/asynq">asynq</a> 真的是一个很好的库，作为刚上手消息队列的新人，我用不上 kafka 那样高大上的方案，我只需要能简单快速地上手，能理解什么是消息队列就行</p><p>最后还折腾了一圈外围的服务来提升服务的可观测性，这方面其实没什么好说的，go-zero 框架都做了适配，也就是增加个配置项的事情，但是这在答辩的时候无疑是个很大的加分项</p><hr><h2 id="其他人的项目">其他人的项目</h2><p>关于我对于拿到第一那么震惊还有另一个原因，就是我的确看见了很多大佬与很多很好的项目，有的项目用上了 redis 里面的集合运算，我感觉有点眼前一亮，我这也是第一次用 redis 于是就没想着整太多花活。我还看见有人把 ChatGPT 集成在里面的，真的是绝了，还有人在开发的时候发现赫兹框架有问题，给官方提了 PR ，还有的人在答辩的时候说了很多我根本不了解的次，什么水平越权垂直越权的，这些都是大佬哇</p><p>答辩的时候也从其他项目学到了不少东西，比如说手表问题：你有了两块手表，结果反而不能判断时间了，因为两块手表的时间不一样，这意思就是不能为了获得一个信息而设计两套机制，不然如果不一样的话你也不知道该信哪一个</p><hr><h2 id="关于实习">关于实习</h2><p>实习？是的，青训营本来也包含了招人的目的。这届我们杭助参加的人不少，前端后端的都有，然后有个前端进阶的字节问他要不要去实习，结果他说暑假才能实习，就直接被拉进人才库了（</p><p>我记得报名的时候有一项是问有没有在字节实习或者入职的目的（大概是这个意思），然后当时我填的否，我想如果我填的是的话肯定也有人会来联系我的</p><p>然后应该是要去参加面试（听唠嗑群里消息），然后如果没过还是会被丢进人才库（</p><p>如果先告诉我这次项目的结果的话，我肯定会填是，然后去试一试的，毕竟也是一次开拓眼界的机会，但实际上我也没做好去实习就业的准备，我计网、算法、还有各种八股都没掌握，k8s之类的云原生基础设施也没折腾过，还有 golang 的一些特性都答不上来，我只能说我还得好好学习</p><p>这两天听群里学长学姐讨论就业形势，就像是骆驼祥子进了茶馆看见了老马一样（那么优秀的人，结果也是工作都找不到？这也是我会是的未来嘛？</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;PS：以后写感想类博客一定要当天冲完，不然拖个一个星期真的找不到那种劲了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;首先我真的想向字节跳动和掘金社区道个歉，这次青训营我主要就是奔着大项目来的 &lt;s&gt;，平时的课基本没怎么听&lt;/s&gt;&lt;/p&gt;
&lt;p&gt;关于</summary>
      
    
    
    
    <category term="青训营" scheme="https://www.nickxu.top/categories/%E9%9D%92%E8%AE%AD%E8%90%A5/"/>
    
    <category term="字节跳动-5th-后端" scheme="https://www.nickxu.top/categories/%E9%9D%92%E8%AE%AD%E8%90%A5/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-5th-%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="字节青训营" scheme="https://www.nickxu.top/tags/%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E8%90%A5/"/>
    
  </entry>
  
  <entry>
    <title>雅思英语考试基本介绍</title>
    <link href="https://www.nickxu.top/2023/03/06/%E9%9B%85%E6%80%9D%E8%8B%B1%E8%AF%AD%E8%80%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/"/>
    <id>https://www.nickxu.top/2023/03/06/%E9%9B%85%E6%80%9D%E8%8B%B1%E8%AF%AD%E8%80%83%E8%AF%95%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</id>
    <published>2023-03-06T13:13:08.000Z</published>
    <updated>2023-03-09T01:50:39.654Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这是本人课上记的笔记，不代表我会去考（</p></blockquote><h2 id="考试分类">考试分类</h2><p>两大类</p><ul><li>A类 学术类 Acadmic ☑️</li><li>G类 培训类/移民类 （简单很多</li></ul><p>听力口语部分两个是一样的，阅读写作G类简单</p><p>（其实还有一种生活技能类，和我们关系不大，很多小孩子考</p><p>A类中的分类</p><ul><li><p>普通雅思</p><p>成绩只作为英语水平能力证明</p></li><li><p>UKVI雅思</p><p>成绩除了证明能力之外，还可以帮助你申请英国的签证</p></li></ul><p>如果绝对有把握能过就考普通雅思，不然就UKVI（会多一点钱，题目一样，但是学校会告诉你可以申请签证，提前几个月去当地的语言班，之后再考一遍</p><h2 id="考试信息">考试信息</h2><p>IELTS</p><p>2小时45分钟，包含听说读写，换算后总分9分，0.25分一档</p><ul><li>听 30min</li><li>读 60min</li><li>写 60min</li><li>说 11-14min</li></ul><p>同类的考试还有托福</p><ul><li>都是标准化考试，难度差不多体型不一样</li><li>雅思主办方两个英国，一个澳大利亚，所以要熟悉一下英式和澳大利亚方言口音</li><li>托福是美国办的</li><li>托福全机考，雅思有人面对面</li><li>雅思作文难些，托福阅读难些</li><li>雅思托福大多数时候是通用的</li></ul><p>口语考试</p><ul><li><p>和托福不一样，雅思考两天，口语（说）单独安排在考试那周的周一到周五（提前完成）</p><p>其他的在礼拜六的上午</p></li><li><p>雅思口语题库一年换4次（一个季度），建议先让其他人考一下，参考一下其他人的题目</p></li><li><p>考场在学校，其实可以在11教门口待着，下来一个问一个</p></li><li><p>老师变数很大，有很和蔼的，有很严的，但是不要被影响，态度好的也不一定打高分</p></li></ul><p>分数水平</p><ul><li>全国分数最多是在 5.5-6 分（但是各种各样的人存在，导致分数比较低</li><li>杭电的努力一下 6.5-7 分</li><li>阅读和听力提升较快</li></ul><h2 id="考试流程">考试流程</h2><h3 id="听力">听力</h3><ul><li><p>30 min 4 sections 40 questions（每题1分</p></li><li><p>难度递增</p><p>策略：简单题一定要保证正确</p></li><li><p>60%以上英式英语，夹杂美式甚至是印度（</p></li></ul><p>四部分内容</p><ol><li>二人日常社交情景对话（一问一答</li><li>日常社交单人独白</li><li>四人教育/训练对话场景</li><li>单人学术类型独白</li></ol><h3 id="阅读">阅读</h3><ul><li><p>60min 3 passages 40 questions</p></li><li><p>test are taken from books, magazines, journals and newspaper</p></li><li><p>有些人会遇到加试（雅思托福都有，很常见</p><p>别人都在写作文了你还在阅读，别紧张</p><p>加一篇测试的新题目（不计分，随机挑人测试一下新题目难度，但是你不知道是哪一题，时间也会增加</p></li><li><p>托福和雅思有个不一样是阅读的最后一题可能是两分或者三分</p></li></ul><h3 id="写作">写作</h3><ul><li><p>60min 2tasks</p></li><li><p>task1 20min 小作文 150字 三分之一的分</p><p>图表类，描述</p></li><li><p>task2 40min 大作文 250字 三分之二的分</p><p>议论文（AB选一个说明理由，某件事已经发生了怎么解决）</p></li><li><p>不是字越多越好，不超过正负10%最好</p></li><li><p>内容重要</p></li><li><p>托福大小作文分数一样，小作文先看文章，再听，再写</p></li><li><p>要积累单词，雅思可能有很多没接触过的主题（比如说犯罪）</p></li><li><p>教育相关的话题是最多的</p></li></ul><p>印象分</p><ul><li>字体不潦草</li><li>段与段之间空一行</li><li>每段第一个字顶格</li></ul><h3 id="口语">口语</h3><ul><li><p>it is not what you say, it is how you say it!</p></li><li><p>要学会扯</p></li><li><p>4-5min 自我介绍和采访，一问一答（每个问题的回答要有20～30s</p></li><li><p>3-4min 个人长独白 给你一张题卡，有一分钟时间准备，两分钟时间演讲，有草稿纸铅笔</p></li><li><p>4-5min 结合第二部分的题目交互式谈话</p></li></ul><p>Four criteria</p><ul><li>Fluency and coherence<ul><li>不能有长时间的空白（&gt;1s）</li><li>Thinking for idea is fine Thinking for words is not fine</li><li>用最直观的方法体现逻辑：结构、指示词连接词</li><li>自然（Humm…I guess … it’s cool</li></ul></li><li>Lexical resource<ul><li>放弃一些所谓的万能动词make hold have（一个动词和很多名称可以搭配make friends/tea/coffee/bed/face</li><li>使用更专业更形象的动词</li><li>学习更加地道的讲法</li><li>修辞手法：排比+押韵</li><li>不是到现场现编，准备很多熟悉的素材</li><li>尝试改述 不要一直用题目里面的表述</li></ul></li><li>Grammatical range and accuracy<ul><li>复杂句式</li><li>不用明显依赖于准备好的段子</li><li>对观点有证据和支持</li></ul></li><li>Pronunciation<ul><li>单词读错（重音放错）</li><li>元音</li><li>英式、美式混杂</li></ul></li></ul><p>在口语和写作中存在主观分，有0.5分左右的浮动差异</p><p>印象分</p><ul><li>凳子不能坐满</li><li>面带微笑</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;这是本人课上记的笔记，不代表我会去考（&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;考试分类&quot;&gt;考试分类&lt;/h2&gt;
&lt;p&gt;两大类&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A类 学术类 Acadmic ☑️&lt;/li&gt;
&lt;li&gt;G类 培训类/移民类 （简单很</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ChatGPT对话记录（四）：手动递归下载依赖的麻烦</title>
    <link href="https://www.nickxu.top/2023/03/05/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E6%89%8B%E5%8A%A8%E9%80%92%E5%BD%92%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E7%9A%84%E9%BA%BB%E7%83%A6/"/>
    <id>https://www.nickxu.top/2023/03/05/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E6%89%8B%E5%8A%A8%E9%80%92%E5%BD%92%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E7%9A%84%E9%BA%BB%E7%83%A6/</id>
    <published>2023-03-05T14:23:18.000Z</published>
    <updated>2023-03-05T14:24:34.743Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我在pkgs.org下包的时候总是要手动递归下载依赖，真的好麻烦</p></blockquote><hr><p>是的，手动递归下载依赖的确很麻烦，尤其是在安装大型软件包时。幸运的是，有些包管理器提供了自动递归下载依赖的功能，这可以大大简化安装过程。</p><p>例如，如果你正在使用Ubuntu或Debian发行版，可以使用APT包管理器来自动下载软件包及其依赖项。只需运行以下命令即可安装软件包并自动下载其所有依赖项：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install <span class="keyword">package</span>-name</span><br></pre></td></tr></table></figure><p>对于其他发行版，也可能有类似的包管理器可用，你可以参考对应的文档了解如何使用它们来自动下载依赖项。</p><p>如果你使用的包管理器不支持自动递归下载依赖，那么你可以考虑使用类似于&quot;apt-rdepends&quot;的第三方工具，该工具可以帮助你自动递归下载依赖项。使用这种工具可能需要一些命令行技能，但可以大大减少手动递归依赖的麻烦。</p><p>最后，有些软件包可能会提供单独的安装程序或安装脚本，可以自动下载并安装所有依赖项。在下载软件包之前，建议先查看软件包的文档，以确定是否提供了这种安装方法。</p><hr><blockquote><p>我是说我要在一个离线的服务器上安装软件，然后我找到了包，但是有一堆依赖，一个一个下太麻烦了</p></blockquote><hr><p>我明白了你的问题，如果你需要在一个离线的服务器上安装软件包及其依赖项，而又不想一个一个手动下载它们，可以考虑使用类似于&quot;apt-offline&quot;的工具。</p><p>&quot;apt-offline&quot;是一个命令行工具，它可以帮助你在一个在线的计算机上生成一个安装程序，该程序包含了软件包及其所有依赖项的下载链接。然后，你可以将该安装程序复制到离线的服务器上，使用该程序在离线服务器上安装软件包及其依赖项。</p><p>以下是使用&quot;apt-offline&quot;的基本步骤：</p><ol><li><p>在在线计算机上安装&quot;apt-offline&quot;工具：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install apt-offline</span><br></pre></td></tr></table></figure></li><li><p>在在线计算机上生成安装程序，该程序包含软件包及其依赖项的下载链接。假设要安装的软件包是&quot;package-name&quot;，可以运行以下命令：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-offline <span class="keyword">set</span> offline.sig --install-packages <span class="keyword">package</span>-name</span><br></pre></td></tr></table></figure><p>这将在当前目录中生成一个名为&quot;offline.sig&quot;的签名文件，其中包含了软件包及其所有依赖项的下载链接。</p></li><li><p>将签名文件复制到离线服务器上。</p></li><li><p>在离线服务器上使用&quot;apt-offline&quot;安装程序来安装软件包及其依赖项。运行以下命令：</p><p><code>sudo apt-offline install offline.sig</code></p><p>这将自动下载软件包及其所有依赖项，并将它们安装在离线服务器上。</p></li></ol><p>请注意，&quot;apt-offline&quot;只能下载安装软件包及其依赖项，而不能下载更新。如果你需要在离线服务器上更新软件包及其依赖项，请考虑使用其他工具或方法。</p><hr><blockquote><p>有没有适用于centos的</p></blockquote><hr><p>是的，对于CentOS或其他基于Red Hat的发行版，可以使用类似于&quot;yumdownloader&quot;或&quot;reposync&quot;的工具来下载软件包及其依赖项。</p><p>&quot;yumdownloader&quot;是一个命令行工具，可以帮助你下载指定软件包及其依赖项的RPM包。以下是使用&quot;yumdownloader&quot;下载软件包及其依赖项的基本步骤：</p><ol><li><p>在在线计算机上安装&quot;yum-utils&quot;软件包，该软件包包含了&quot;yumdownloader&quot;工具：</p><p><code>sudo yum install yum-utils</code></p></li><li><p>在在线计算机上使用&quot;yumdownloader&quot;下载软件包及其依赖项。假设要下载的软件包是&quot;package-name&quot;，可以运行以下命令：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yumdownloader --resolve <span class="keyword">package</span>-name</span><br></pre></td></tr></table></figure><p>这将下载软件包及其所有依赖项的RPM包，并将它们保存在当前目录中。</p></li><li><p>将RPM包复制到离线服务器上，并使用&quot;rpm&quot;命令进行安装。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh <span class="keyword">package</span>-name.rpm</span><br></pre></td></tr></table></figure><p>这将安装软件包及其依赖项。</p></li></ol><p>&quot;reposync&quot;是另一个基于&quot;yum&quot;的工具，它可以帮助你下载整个软件仓库中的软件包及其依赖项。以下是使用&quot;reposync&quot;下载软件包及其依赖项的基本步骤：</p><ol><li><p>在在线计算机上安装&quot;yum-utils&quot;软件包，该软件包包含了&quot;reposync&quot;工具：</p><p><code>sudo yum install yum-utils</code></p></li><li><p>在在线计算机上使用&quot;reposync&quot;下载软件包及其依赖项。假设要下载的软件包来自于名为&quot;repo-name&quot;的软件仓库，可以运行以下命令：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reposync -r repo-name <span class="attr">--download-metadata</span> <span class="attr">--download-path</span>=/path/<span class="selector-tag">to</span>/save/packages</span><br></pre></td></tr></table></figure><p>这将下载&quot;repo-name&quot;仓库中的所有软件包及其依赖项，并将它们保存在指定的目录中。</p></li><li><p>将下载的RPM包复制到离线服务器上，并使用&quot;rpm&quot;命令进行安装。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh <span class="keyword">package</span>-name.rpm</span><br></pre></td></tr></table></figure><p>这将安装软件包及其依赖项。</p></li></ol><p>请注意，下载整个软件仓库的方法可能需要较长时间和较大的存储空间，因此请确保你有足够的磁盘空间和时间。同时，请注意下载的软件包及其依赖项可能会有版本冲突等问题，请确保在离线服务器上使用的软件包版本与在线计算机上的一致。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;我在pkgs.org下包的时候总是要手动递归下载依赖，真的好麻烦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;是的，手动递归下载依赖的确很麻烦，尤其是在安装大型软件包时。幸运的是，有些包管理器提供了自动递归下载依赖的功能，这可以大大简化安装</summary>
      
    
    
    
    <category term="ChatGPT 对话记录" scheme="https://www.nickxu.top/categories/ChatGPT-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ChatGPT" scheme="https://www.nickxu.top/tags/ChatGPT/"/>
    
    <category term="Linux" scheme="https://www.nickxu.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>服务器离线安装Docker</title>
    <link href="https://www.nickxu.top/2023/03/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Docker/"/>
    <id>https://www.nickxu.top/2023/03/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Docker/</id>
    <published>2023-03-05T03:45:23.000Z</published>
    <updated>2023-03-05T14:35:39.199Z</updated>
    
    <content type="html"><![CDATA[<p>奶奶的昨天在学校的服务器上离线安装docker，折腾了一天都没搞定（</p><p>你要下包吧，一堆递归依赖要手动递归下载🙄</p><p>然后现在docker也没有源码编译了</p><p>我在官方文档找哇，找到了个直接下二进制文件的</p><p>然后搞定了</p><p><a href="https://docs.docker.com/engine/install/binaries/#install-daemon-and-client-binaries-on-linux">https://docs.docker.com/engine/install/binaries/#install-daemon-and-client-binaries-on-linux</a></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303052235444.png" alt="image-20230305223522937"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;奶奶的昨天在学校的服务器上离线安装docker，折腾了一天都没搞定（&lt;/p&gt;
&lt;p&gt;你要下包吧，一堆递归依赖要手动递归下载🙄&lt;/p&gt;
&lt;p&gt;然后现在docker也没有源码编译了&lt;/p&gt;
&lt;p&gt;我在官方文档找哇，找到了个直接下二进制文件的&lt;/p&gt;
&lt;p&gt;然后搞定了&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>写在大二下开学之初</title>
    <link href="https://www.nickxu.top/2023/03/01/%E5%86%99%E5%9C%A8%E5%A4%A7%E4%BA%8C%E5%BC%80%E5%AD%A6%E4%B9%8B%E5%88%9D/"/>
    <id>https://www.nickxu.top/2023/03/01/%E5%86%99%E5%9C%A8%E5%A4%A7%E4%BA%8C%E5%BC%80%E5%AD%A6%E4%B9%8B%E5%88%9D/</id>
    <published>2023-03-01T13:30:14.000Z</published>
    <updated>2023-03-05T14:36:19.346Z</updated>
    
    <content type="html"><![CDATA[<p>如你所见，我已经两个多月没有更新博客了，现在开学了，总得恢复更新节奏吧（</p><p>最近很乱，就随便写写寒假到现在发生的事吧，想到哪里写到哪里</p><h2 id="手搓学习通">手搓学习通</h2><p>如果你要问我我寒假这两个月干什么去了，我会和你说，我一个人折腾完了两个项目</p><p>一个是文艺数法学院的一个产品包装教学系统的后端，一个是青训营的项目，先说第一个</p><p>这个项目是上个学期杭助群里看见的，缺后端的人，然后我就进了</p><p>进了之后发现两个前端，就我一个后端（乐</p><p>我为什么想参加呢？第一个自然是有💰（三个人分了大几千块），第二个是想熟悉一下 <code>go-zero</code> 框架，第三个也是想丰富一下简历</p><p>对后端来说，我需要完成以下功能：班级系统，然后可以布置作业，学生相互批改作业，有班级云盘放资料，有教学视频给学生看…</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303012225538.png" alt="image-20230301222502268"></p><blockquote><p><s>乐！这不就是学习通嘛（</s></p></blockquote><hr><h2 id="夜之城度假">夜之城度假</h2><p>我很快冲完了班级和云盘两个服务，剩一个作业的系统没写，毕竟有点累了，就想摆一下</p><p>然后正好 2077 打半价，这游戏缝缝补补了两年，我看了一下测评，现在可以入手了</p><p>讲真，我感觉现在这质量已经勉强能配得上发售的宣传了，我认为其实还不错，最后给了个好评</p><p>一开始我还没搞懂各种机制，第一个档被各种虐，去看攻略才熟悉，其实你偷芯片的时候上到天台拿到三郎的武士刀觉，后面就很舒服了</p><p>然后第二个档我打算尝试一下<a href="https://www.bilibili.com/video/BV1bV4y1T784/?share_source=copy_web&amp;vd_source=5ca30838bf3c8b357bddca1ff2565902">刀剑流</a>，跟着教程走很舒服，那几天我真的沉迷其中，基本上就是住在夜之城了</p><p>我已经很久没有遇到这么让我惊艳的作品了，上一次还是大表哥2</p><p>可惜的是，这东西剧情太短了，大概40小时就干完主线了，让然后我又去看各种攻略，尝试各种流派</p><p>然后我第三个档尝试的是<a href="https://www.bilibili.com/video/BV14V4y1p7Wn/?share_source=copy_web&amp;vd_source=5ca30838bf3c8b357bddca1ff2565902">黑客流</a>，这玩到后期是真的爽，拿着网监5基本上是瞪谁谁死，拿着应龙单挑荒坂塔那都不是事</p><p>而且我玩的是女V，这配音也是一流的，和原子之心的冰箱是一个人哦！</p><details class="toggle" ><summary class="toggle-button" style="">玩女V必看（不用感谢我😎</summary><div class="toggle-content"><p>捏脸：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">皮肤4</span><br><span class="line">发型12</span><br><span class="line">眼睛11</span><br><span class="line">眉毛7</span><br><span class="line">鼻子5</span><br><span class="line">嘴巴6</span><br><span class="line">下巴4</span><br><span class="line">耳朵14</span><br></pre></td></tr></table></figure><p>完美身材：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">版本：1.6，不上图了，就单纯敲字，请自行实验</span><br><span class="line">1.前期准备</span><br><span class="line">在衣柜里面设置3套衣服，第1套是正常的（就是什么都穿的），第2套什么都不穿，第3套准备一套特殊穿搭（全身连体的衣服）</span><br><span class="line">装备里面，全身上下除了一条正常的裤子以外，什么都不要有（武器可以保留）</span><br><span class="line">2.操作方法</span><br><span class="line">一、装备里面只穿裤子（已经穿了就不用管）和第3套特殊穿搭</span><br><span class="line">二、换成第1套有衣服的正常着装</span><br><span class="line">三、脱内裤</span><br><span class="line">四、穿第2套没衣服的着装</span><br><span class="line">3.最终结果</span><br><span class="line">不管读盘、退出，还是穿脱各种装备，始终都能保持完美身材</span><br></pre></td></tr></table></figure></div></details><p>最后我大概玩了 170 个小时吧，把所有的结局和所有的支线都玩过一遍了，感觉支线比主线的东西多多了，而且很多东西都是很用心的，同时也无不对阉割的内容感到遗憾，比如说冰箱里的神迹后面本来还有一串任务的，但是都被砍了</p><p>玩完游戏本体我又去把边缘行者找来看了一遍，毕竟在夜之城住了好久了，动画的带入感真是极强（里面的地方都认得在什么地方</p><p>看完之后后劲也是很大的，又回去把重锤锤了几遍（乐</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303012256100.png" alt="image-20230301225612064"></p><blockquote><p>结束在夜之城的度假之后，我找了张 V 的公寓的桌面壁纸，真的是挺好看的</p></blockquote><hr><h2 id="青训营破防">青训营破防</h2><p>然后就是青训营开营了，第五届字节跳动青训营其实和第三届差不多，后端的课相差不大，项目居然也是一模一样的（写一个精简版的抖音后端）</p><p>因为这次我想带一个大一的一起做项目，所以我选的是基础班，然后带了几个大一的和yeebing一起做项目</p><p>为了和第三届的项目（单体gin）拉开点差距，我上了微服务，然后自然是go-zero框架</p><p>这样以来对新人的压力也不会很大，业务代码可以参考第三届的项目，微服务架构可以参考我的项目</p><p>也可以让评委看看我这一套怎么样，毕竟相同的架构的项目是要上生产环境的，面试系统也是用的是go-zero</p><p>项目公布的那一晚，我就拉着他们开会，各种分析，各种讲解，各种手把手，BB了好几个小时</p><p><a href="/2023/01/13/%E7%AC%AC%E4%BA%94%E5%B1%8A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E9%9D%92%E8%AE%AD%E8%90%A5%E9%A1%B9%E7%9B%AE%E4%BC%9A%E8%AE%AE%E7%BA%AA%E8%A6%81/">第五届字节跳动青训营项目会议纪要</a></p><p>然后我把架子搭起来写了一些东西，就把大部分东西想留给他们锻炼锻炼</p><p>然后呢？啥动静都没有（</p><p>平时基本也就我一个人在群里面说话，真的是破大防</p><p>但是有个大一的其实还行，学的很快，一上来就搞定了三个接口，也就这位比较让我满意</p><p>原定是过年前要把所有功能都冲完，结果等到初十还没搞完</p><p>然后这时候我一边要把另一个项目补完，一边还要给这个项目擦屁股，我真的是服了，这帮人基本是啥都帮不了</p><p>真的是让人心寒，基本变成单人项目了（幸好yeebing也在帮忙，不然我真的得累死</p><p>这时还有个负责消息相关的态度还不错，勉勉强强地完成了相关接口，但是其他的我根本就不想评价，还有直接说自己啥都不懂的，我那天讲那么久都白讲了？</p><p>这绝对不是能力问题，而是态度，即使你说你啥都不会写，那你打下手总行吧？我写完了接口需要有人测试，完成了所有接口需要有人用app测试，结果呢？根本没人理我</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303012353313.png" alt="image-20230301235341289"></p><blockquote><p>我发誓我以后再也不带生人做项目了</p></blockquote><p>这些还不完全是陌生人，是上个学期面试招进来的，每个人我都是亲自面过的，就这种素质，我第三届的时候其实也是啥都不懂，gorm的语句都是依葫芦画瓢+copilot帮我写的，但是我前前后后commit数也有个两位数，也积极配合测试，甚至当时还买了个二手的荣耀Magic2来做测试机</p><p>最后还是我来擦屁股，把各种bug修了，把各个接口完成了，但是我还得上缓存和消息队列做各种优化</p><p>然后返校前我还得去把科目四给考了，事情真的不少，那段时间真的是忙</p><hr><h2 id="第一次装机">第一次装机</h2><p>来点过年的小插曲，缓和一点气氛</p><p>过年的时候我爸的办公室要更新几台机子，我看了一下情况，从一些老古董里面挑了两台勉强还能用的，可以升级一下配置，然后还得再装一台新机</p><p>虽然我初中就开始折腾硬件了，但是我家都是笔记本，也就是换个内存硬盘之类的，但是台式机还没折腾过</p><p>我就趁这个机会学习一下，然后我就在B上看硬件茶谈的装机教程，感觉我也行了，就去买了一堆硬件</p><table><thead><tr><th>类型</th><th>名称&amp;链接</th><th>价格</th></tr></thead><tbody><tr><td>机箱</td><td><a href="https://item.taobao.com/item.htm?spm=a1z0d.6639537/tb.0.0.78f17484jRRuQt&amp;id=591613843038">傻瓜超人 K88</a></td><td>159</td></tr><tr><td>主板</td><td><a href="https://item.taobao.com/item.htm?spm=a1z0d.6639537/tb.0.0.78f17484jRRuQt&amp;id=679885751158">昂达B660-VH-B</a></td><td>379</td></tr><tr><td>CPU</td><td><a href="https://item.taobao.com/item.htm?spm=a1z0d.7625083.0.0.5c5f4e69Go4Mnh&amp;id=667946031150">I3-12100</a></td><td>685</td></tr><tr><td>内存</td><td><a href="https://item.jd.com/100014056864.html#none">金百达 8GB*2 DDR4 3200</a></td><td>249</td></tr><tr><td>硬盘</td><td><a href="https://item.jd.com/100011216263.html#none">京东京造 5系 512GB M.2 PCIe3.0</a></td><td>229</td></tr><tr><td>电源</td><td><a href="https://mobile.yangkeduo.com/goods1.html?_wvx=10&amp;refer_share_uin=CG7CTRXRWNP5BMMEAQADLBCQTQ_GEXDA&amp;refer_share_id=mTe407rsWBayLY7YtvMIwpKXYT4GUoRC&amp;share_uin=CG7CTRXRWNP5BMMEAQADLBCQTQ_GEXDA&amp;page_from=101&amp;_oak_share_snap_num=21800&amp;_oak_share_detail_id=0&amp;_wv=41729&amp;refer_share_channel=copy_link&amp;pxq_secret_key=VC2CGZFS4SW275VHIN3PXW7ZJ74WJXMHULVMFXQBMLTJSKVMNBHA&amp;goods_id=275474400230">技嘉 GP-P450B</a></td><td>179</td></tr><tr><td>散热</td><td><a href="https://mobile.yangkeduo.com/goods1.html?_wvx=10&amp;refer_share_uin=CG7CTRXRWNP5BMMEAQADLBCQTQ_GEXDA&amp;refer_share_id=hZoF0YrdP8oFmpXWgVawTndGpklYjDTb&amp;share_uin=CG7CTRXRWNP5BMMEAQADLBCQTQ_GEXDA&amp;page_from=101&amp;_oak_share_snap_num=4150&amp;_oak_share_detail_id=0&amp;_wv=41729&amp;refer_share_channel=copy_link&amp;pxq_secret_key=VC2CGZFS4SW275VHIN3PXW7ZJ6NTFUQ4FZVVEV65G2YIIOTB7KSA&amp;goods_id=186518396784">乔思伯CR1400</a></td><td>60</td></tr></tbody></table><div class="fj-gallery"><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022227112.jpeg" alt="45A34C3F-7970-45F6-994C-8BFFA542164A_1_105_c"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022229536.jpeg" alt="52B834D4-3717-41B9-AD06-3E5B0E1F577F_1_105_c"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022230382.png" alt="image-20230302223013352"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022230309.png" alt="image-20230302223026273"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022236262.jpeg" alt="15395619-4734-4365-8DF8-450639F9A6D8_1_105_c"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022236946.jpeg" alt="5038140C-3966-4297-A4EC-59719D8C5C78_1_105_c"></p>          </div><p>然后我就开装了，等我按照教程在机箱里面装好了之后，才发现点不亮（悲</p><p>然后我就被迫拆出来重新折腾（早知道就先测试好了再装进去了</p><p>排查一圈感觉是主板的问题，我就去找店家理论，店家指导一通也搞不定，只能退货</p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022238768.png" alt="5DCA0CE9-5492-4CA2-84FC-20DE063847D6" style="zoom:50%;" /><blockquote><p>真是中彩票了，以后再也不买昂达的主板了（</p></blockquote><p>但是这个时候我要回家了，所以我得把机箱搬回去再折腾</p><p>等过了几天我收到新主板了之后，我终于点亮了</p><p>但是很奇怪，我一进PE就蓝屏，没办法，只能通过官方镜像安装了</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022241678.jpeg" alt="57291E8C-2002-43D2-ACA5-832971258317_1_105_c"></p><blockquote><p>办公嘛，用什么Windows11，直接Windows10 LTSC 就够了</p></blockquote><p>但是呢，这个非模组电源的线也太丑了吧（</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022242543.jpeg" alt="3A6117B2-EF7B-4B99-B0A6-92D6960A3844_1_105_c"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022242185.jpeg" alt="A6464FB8-58CE-4D09-87AE-6E05EE69478D_1_105_c"></p><p>这个我感觉理线好麻烦哇，算了就这样吧，反正不是我用（bushi</p><p>以后要是自己装机的话大概了会用全模组电源了</p><p>这次装机也算是学了很多吧，什么主板显卡之类的之前也没了解多少，这次算是入了DIY的门了，关注了一堆UP，我以后如果要搞一台台式肯定会是自己组了</p><hr><h2 id="开学考挂科">开学考挂科</h2><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303012350735.png" alt="image-20230301235053699" style="zoom:50%;" /><blockquote><p>大物和离散要是能隔个一天就好了</p></blockquote><p>返校了，第二天就考了习概，然后有点空档，我就一直在折腾青训营的项目，折腾各种优化，redis、消息队列、异步、定时任务等等</p><p>然后离散的考试和提交项目的时间重合了，所以我还得早点搞完这个项目，还得写个<a href="https://hdu-help.feishu.cn/docx/KuGidErAIogvWDxcn2VcTrfUntb">汇报文档</a></p><p>结果就是，我折腾到大物的前两天才开始全力复习大物，而离散是一点都没看（毕竟大物比离散难得多</p><p>考完大物我基本就是个废人了，毕竟已经连续工作十几天了，感觉是真的累，期间也没放松过（我就带了个MacBook，也玩不了游戏</p><p>而第二天早上就要考离散，留给我缓冲的时间不多，只能说浅浅复习一波</p><p>到了第二天，我能记得的真的不多，基本上昨天复习的全忘记了，也就图树这类高中竞赛的时候学过的有点把握</p><p>更要命的是，我做到最后十分钟的时候，才发现试卷还有一面，有两道大题，我自己倒吸一口凉气</p><p>人麻了，这怕不是第一次要补考</p><p>然后前几天结果出来了，大物最终成绩61分飘过，离散56分不及格</p><hr><h2 id="前路在何方">前路在何方</h2><p>挂科了心情总是有些不爽的，毕竟我读书这么多年从来也没有遇到考试不及格的情况</p><p>但是谁知道呢？可能要发生点好事就必须要有一些前置条件吧，好事多磨应该就是也个道理</p><p>然后目前在等青训营初评，前不久不是gsoc的组织公布了嘛，<a href="https://summerofcode.withgoogle.com/programs/2023/organizations">我就去看了一下</a></p><p>结果呢？没几个项目是用golang的</p><p>看来看去，感觉也就个keploy的重构客户端的还有点能力完成，但是肯定也一堆人</p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022257833.png" alt="image-20230302225744796"></p><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022308720.png" alt="image-20230302230849672"></p><blockquote><p>然后iyear提醒了一手这个项目的 maintainer ，奶奶的，居然全是阿三（</p></blockquote><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202303022301658.png" alt="image-20230302230119617"></p><p>要知道，印度人在海外可是很抱团的，选上的肯定会是印度人，这项目怕不是用来从Google手上骗经费的（bushi</p><p>为什么就没有国人的项目包容一下华人呢？</p><p>看来看去我感觉还是准备开源之夏吧，ospp比gsoc简单不少，gsoc还要各种攀关系，混脸熟，人情世故真的是在世界各地都有</p><p>So？前路在何方？</p><p>我也不知道，走一步算一步吧，这个学期想把k8s学一学，然后书架上还有一堆书可以看一看，总不能一直放着吃灰吧</p><p>暑假大概率还要参加亚运会志愿者的培训，这学期还是挺忙的</p><p>前几天产品包装系统的甲方又提了些修改意见，还有一堆事情等着我呢</p><p>边走边看吧！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;如你所见，我已经两个多月没有更新博客了，现在开学了，总得恢复更新节奏吧（&lt;/p&gt;
&lt;p&gt;最近很乱，就随便写写寒假到现在发生的事吧，想到哪里写到哪里&lt;/p&gt;
&lt;h2 id=&quot;手搓学习通&quot;&gt;手搓学习通&lt;/h2&gt;
&lt;p&gt;如果你要问我我寒假这两个月干什么去了，我会和你说，我一个人折</summary>
      
    
    
    
    <category term="随笔与总结" scheme="https://www.nickxu.top/categories/%E9%9A%8F%E7%AC%94%E4%B8%8E%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="随笔" scheme="https://www.nickxu.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>ChatGPT对话记录（三）：GORM的行级锁</title>
    <link href="https://www.nickxu.top/2023/02/19/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AGORM%E7%9A%84%E8%A1%8C%E7%BA%A7%E9%94%81/"/>
    <id>https://www.nickxu.top/2023/02/19/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AGORM%E7%9A%84%E8%A1%8C%E7%BA%A7%E9%94%81/</id>
    <published>2023-02-18T16:14:50.000Z</published>
    <updated>2023-02-18T16:17:57.875Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>你知不知道gorm的Clauses方法</p></blockquote><hr><p>是的，我知道gorm的Clauses方法。在GORM中，Clauses方法是用于在查询语句中添加子句的函数。它允许您使用原始的SQL语句或GORM的构建器函数来添加子句。</p><p>Clauses方法返回的是*DB对象，您可以在此对象上继续调用其他GORM函数，例如Where、Order、Limit等，以构建完整的查询语句。Clauses方法的语法如下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db<span class="selector-class">.Clauses</span>(clauseBuilder...)</span><br></pre></td></tr></table></figure><p>其中，clauseBuilder可以是一个字符串表示的原始SQL语句，也可以是一个GORM构建器函数，例如Select、Where、Order、Limit等。</p><p>例如，以下代码使用Clauses方法添加了一个子句，然后使用Where和Find函数来执行查询操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Clauses(<span class="string">&quot;SELECT * FROM users WHERE age &gt; ?&quot;</span>, 18).Where(<span class="string">&quot;name = ?&quot;</span>, <span class="string">&quot;John&quot;</span>).Find(&amp;<span class="built_in">users</span>)</span><br></pre></td></tr></table></figure><hr><blockquote><p>里面有个clause.Locking，能解释一下嘛</p></blockquote><hr><p>是的，<code>clause.Locking</code>是GORM中的一个子句，用于为查询语句添加<code>FOR UPDATE</code>或<code>FOR SHARE</code>语句，以实现数据库中的行级锁。</p><p>在GORM中，您可以通过在<code>Clauses</code>函数中传递<code>clause.Locking</code>子句来为查询语句添加行级锁。具体语法如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_ invoke__">Clauses</span>(clause.Locking&#123;<span class="attr">Strength</span>: <span class="string">&quot;UPDATE&quot;</span>, <span class="attr">Tables</span>: []<span class="keyword">string</span>&#123;<span class="string">&quot;table1&quot;</span>&#125;&#125;).<span class="title function_ invoke__">Find</span>(&amp;result)</span><br></pre></td></tr></table></figure><p>上面的代码将在<code>table1</code>表上添加<code>FOR UPDATE</code>行级锁，并使用<code>Find</code>函数执行查询操作。如果您想使用<code>FOR SHARE</code>语句，则可以将<code>Strength</code>属性设置为<code>&quot;SHARE&quot;</code>。</p><p>请注意，<code>clause.Locking</code>子句只对支持行级锁的数据库有效，例如PostgreSQL、MySQL等。在不支持行级锁的数据库中，此子句将不起作用。此外，行级锁是一种悲观锁，它会对查询的行进行加锁，因此在高并发的情况下，使用行级锁可能会导致性能问题，需要谨慎使用。</p><hr><blockquote><p>type Locking struct { Strength string Table Table Options string } 它的原始定义包含3个值，分别是什么意思？</p></blockquote><hr><p><code>Locking</code>结构体的原始定义包含三个字段，它们分别是<code>Strength</code>、<code>Table</code>和<code>Options</code>。</p><ol><li><p><code>Strength</code>字段用于指定锁的类型，可以是<code>&quot;UPDATE&quot;</code>或<code>&quot;SHARE&quot;</code>。<code>&quot;UPDATE&quot;</code>表示添加<code>FOR UPDATE</code>行级锁，它可以用于查询时对返回的记录进行排他性锁定，以避免并发问题。<code>&quot;SHARE&quot;</code>表示添加<code>FOR SHARE</code>行级锁，它用于查询时对返回的记录进行共享锁定，以确保多个事务可以同时读取记录。</p></li><li><p><code>Table</code>字段用于指定要加锁的表，它可以是字符串类型的表名，也可以是一个<code>Table</code>结构体类型。<code>Table</code>结构体通常用于自定义表的别名、引用和转义。</p></li><li><p><code>Options</code>字段用于指定锁的其他选项，它是一个字符串类型的选项列表，可以包含任何其他锁定选项，例如<code>NOWAIT</code>、<code>SKIP LOCKED</code>等。默认情况下，该字段为<code>&quot;&quot;</code>，即不指定其他选项。</p></li></ol><p>总之，<code>Locking</code>结构体提供了一种简便的方式来指定查询语句中的行级锁类型、加锁表和其他选项，从而帮助开发者更方便地控制数据的并发访问。</p><hr><blockquote><p>如果我不指定table会怎样</p></blockquote><hr><p>如果在使用<code>clause.Locking</code>时不指定表名，GORM会使用默认的表名来添加行级锁。默认情况下，GORM使用查询的主表作为行级锁的表，即如果您使用<code>Model</code>函数指定了模型对象，则主表是该模型对象对应的数据库表。</p><p>例如，以下代码使用<code>clause.Locking</code>在默认表上添加<code>FOR UPDATE</code>锁：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Model(<span class="operator">&amp;</span><span class="keyword">User</span>&#123;&#125;).<span class="keyword">Where</span>(&quot;id = ?&quot;, <span class="number">1</span>).Clauses(clause.Locking&#123;Strength: &quot;UPDATE&quot;&#125;).<span class="keyword">Update</span>(&quot;name&quot;, &quot;new_name&quot;)</span><br></pre></td></tr></table></figure><p>上面的代码将在<code>users</code>表上添加<code>FOR UPDATE</code>锁，因为<code>User</code>模型对应的数据库表是<code>users</code>表。</p><p>如果您不希望使用默认表名，可以通过在<code>Locking</code>子句中指定<code>Table</code>字段来自定义表名，例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Model(<span class="operator">&amp;</span><span class="keyword">User</span>&#123;&#125;).<span class="keyword">Where</span>(&quot;id = ?&quot;, <span class="number">1</span>).Clauses(clause.Locking&#123;Strength: &quot;UPDATE&quot;, <span class="keyword">Table</span>: clause.Table&#123;Name: &quot;user_lock&quot;&#125;&#125;).<span class="keyword">Update</span>(&quot;name&quot;, &quot;new_name&quot;)</span><br></pre></td></tr></table></figure><p>上面的代码将在<code>user_lock</code>表上添加<code>FOR UPDATE</code>锁，而不是默认的<code>users</code>表。</p><p>总之，如果您没有指定表名，则GORM会使用默认表名添加行级锁，但是如果您想自定义表名，则可以通过在<code>Locking</code>子句中指定<code>Table</code>字段来实现。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;你知不知道gorm的Clauses方法&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;是的，我知道gorm的Clauses方法。在GORM中，Clauses方法是用于在查询语句中添加子句的函数。它允许您使用原始的SQL语句或GORM的构建器函</summary>
      
    
    
    
    <category term="ChatGPT 对话记录" scheme="https://www.nickxu.top/categories/ChatGPT-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ChatGPT" scheme="https://www.nickxu.top/tags/ChatGPT/"/>
    
    <category term="GORM" scheme="https://www.nickxu.top/tags/GORM/"/>
    
    <category term="Go" scheme="https://www.nickxu.top/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>ChatGPT对话记录（二）：使用apt完全删除软件包</title>
    <link href="https://www.nickxu.top/2023/02/17/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8apt%E5%AE%8C%E5%85%A8%E5%88%A0%E9%99%A4%E8%BD%AF%E4%BB%B6%E5%8C%85/"/>
    <id>https://www.nickxu.top/2023/02/17/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8apt%E5%AE%8C%E5%85%A8%E5%88%A0%E9%99%A4%E8%BD%AF%E4%BB%B6%E5%8C%85/</id>
    <published>2023-02-17T11:21:50.000Z</published>
    <updated>2023-02-18T16:16:38.112Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>我如何使用apt完全删除软件包，连配置文件也一起删的那种</p></blockquote><hr><p>要使用apt命令完全删除软件包以及其相关的配置文件，可以使用<code>purge</code>选项。以下是具体的步骤：</p><ol><li><p>打开终端，使用root权限或sudo权限登录。</p></li><li><p>运行以下命令以卸载软件包及其配置文件：</p><p><code>sudo apt purge 软件包名称</code></p><p>将<code>软件包名称</code>替换为要删除的软件包的名称。</p></li><li><p>在确认提示中，输入<code>Y</code>以确认卸载操作。</p></li><li><p>如果您还想删除软件包相关的依赖项，可以使用<code>autoremove</code>命令。运行以下命令：</p><p><code>sudo apt autoremove</code></p><p>这将删除已经没有用的软件包及其依赖项。</p></li></ol><p>请注意，在卸载软件包及其配置文件之前，请确保您已经备份了任何重要的配置文件和数据。</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;我如何使用apt完全删除软件包，连配置文件也一起删的那种&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;要使用apt命令完全删除软件包以及其相关的配置文件，可以使用&lt;code&gt;purge&lt;/code&gt;选项。以下是具体的步骤：&lt;/p&gt;
&lt;ol&gt;</summary>
      
    
    
    
    <category term="ChatGPT 对话记录" scheme="https://www.nickxu.top/categories/ChatGPT-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ChatGPT" scheme="https://www.nickxu.top/tags/ChatGPT/"/>
    
    <category term="Linux" scheme="https://www.nickxu.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ChatGPT对话记录（一）：通过SSH密钥进行身份验证</title>
    <link href="https://www.nickxu.top/2023/02/17/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E9%80%9A%E8%BF%87SSH%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/"/>
    <id>https://www.nickxu.top/2023/02/17/ChatGPT%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E9%80%9A%E8%BF%87SSH%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/</id>
    <published>2023-02-16T16:54:10.000Z</published>
    <updated>2023-02-18T16:17:49.817Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>如何将公钥添加到 ~/.ssh/authorized_keys 中</p></blockquote><hr><p>要将公钥添加到<code>~/.ssh/authorized_keys</code>文件中，可以按照以下步骤操作：</p><ol><li><p>将公钥复制到本地计算机的剪贴板中。可以使用以下命令从远程计算机获取公钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@remote_host <span class="string">&quot;cat ~/.ssh/id_rsa.pub&quot;</span></span><br></pre></td></tr></table></figure><p>请确保将<code>user</code>和<code>remote_host</code>替换为您要连接的远程计算机的用户名和主机名。</p></li><li><p>在本地计算机上打开终端窗口并使用以下命令将公钥添加到<code>~/.ssh/authorized_keys</code>文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>将公钥粘贴到终端窗口中，然后按<code>Ctrl-D</code>保存文件并退出终端。</p></li></ol><p>现在，您应该能够使用SSH密钥连接到远程计算机，而无需输入密码。请确保将公钥添加到正确的用户的<code>~/.ssh/authorized_keys</code>文件中，否则您可能无法成功连接。</p><p>（本人PS：这里应该是说反了，应该是把自己的公钥放到远程的 <code>authorized_keys</code>  ）</p><hr><blockquote><p>我已经添加了公钥，但提示 <a href="mailto:root@1.15.112.229">root@1.15.112.229</a>: Permission denied (password).</p></blockquote><hr><p>如果您已经将公钥添加到远程主机的<code>~/.ssh/authorized_keys</code>文件中，但仍然收到密码验证失败的错误消息，则可能存在以下问题：</p><ol><li><p>您在连接时使用了错误的用户名：请确保您在连接时使用了正确的用户名，这是指您添加公钥时使用的用户名。</p></li><li><p>权限问题：请确保您的<code>~/.ssh</code>目录和<code>~/.ssh/authorized_keys</code>文件的权限设置正确。这两个文件应该只有您本人可以读写，而不是其他人。可以使用以下命令修复权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>SELinux或防火墙问题：如果您的远程主机启用了SELinux或防火墙，请确保它们不会阻止您的SSH连接。您可以通过临时禁用SELinux或防火墙来测试它们是否是问题的根本原因。</p></li><li><p>SSH服务器配置问题：最后，您可能需要检查远程主机上的SSH服务器配置文件以确保它已正确配置以允许公钥身份验证。如果您无法解决问题，请尝试联系远程主机管理员或系统管理员以获取更多帮助。</p></li></ol><hr><blockquote><p>Load key “/Users/nx/.ssh/id_rsa.pub”: invalid forma</p></blockquote><hr><p>这个错误通常出现在您正在尝试使用错误的文件来加载SSH密钥。</p><p><code>.pub</code>文件是SSH密钥对中的公钥，而不是私钥。请确保您正在使用私钥文件（默认为<code>id_rsa</code>）而不是公钥文件来加载SSH密钥。</p><p>请使用以下命令来加载私钥文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add /path/to/private/key</span><br></pre></td></tr></table></figure><p>请将<code>/path/to/private/key</code>替换为您的私钥文件的实际路径。如果您不确定私钥文件的位置，可以使用以下命令查找：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -al ~/.ssh</span><br></pre></td></tr></table></figure><p>上述命令将列出您<code>.ssh</code>目录中的所有文件和目录，包括您的SSH密钥对。在此列表中查找包含<code>id_rsa</code>的文件，这将是您的私钥文件。</p><p>请注意，私钥文件的权限也非常重要。在加载SSH密钥之前，请确保私钥文件的权限设置为只有您自己可以读写，如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /path/to/private/key</span><br></pre></td></tr></table></figure><p>如果上述方法不起作用，请检查您的私钥文件是否已被损坏。您可以尝试创建一个新的SSH密钥对，并将公钥添加到您想要连接的远程主机上。</p><hr><blockquote><p>我怀疑是远程服务器没有开启公钥登录</p></blockquote><hr><p>如果您已经确保本地计算机上的SSH密钥和远程计算机上的<code>~/.ssh/authorized_keys</code>文件都正确设置，但仍然无法使用SSH密钥进行身份验证，则可能是因为远程计算机上的SSH服务器没有正确配置以允许SSH密钥身份验证。</p><p>首先，请确保远程计算机上的SSH服务器已启用公钥身份验证。在远程计算机上打开<code>/etc/ssh/sshd_config</code>文件，并检查以下设置是否正确设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>如果这些设置未正确设置，您需要将它们更改为上述值，保存文件并重新启动SSH服务器。</p><p>如果仍然无法使用SSH密钥进行身份验证，请检查远程计算机上的SSH服务器日志以获取更多详细信息。在大多数Linux系统上，SSH服务器日志文件位于<code>/var/log/auth.log</code>或<code>/var/log/secure</code>中。检查日志文件是否包含有关SSH连接和身份验证失败的任何错误消息。</p><p>如果您仍然无法解决问题，请尝试联系远程计算机的管理员或系统管理员以获取更多帮助。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;如何将公钥添加到 ~/.ssh/authorized_keys 中&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;要将公钥添加到&lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;文件中，可以按照以下步骤操作：&lt;/p&gt;
&lt;o</summary>
      
    
    
    
    <category term="ChatGPT 对话记录" scheme="https://www.nickxu.top/categories/ChatGPT-%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ChatGPT" scheme="https://www.nickxu.top/tags/ChatGPT/"/>
    
    <category term="Linux" scheme="https://www.nickxu.top/tags/Linux/"/>
    
    <category term="SSH" scheme="https://www.nickxu.top/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>第五届字节跳动青训营项目会议纪要</title>
    <link href="https://www.nickxu.top/2023/01/13/%E7%AC%AC%E4%BA%94%E5%B1%8A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E9%9D%92%E8%AE%AD%E8%90%A5%E9%A1%B9%E7%9B%AE%E4%BC%9A%E8%AE%AE%E7%BA%AA%E8%A6%81/"/>
    <id>https://www.nickxu.top/2023/01/13/%E7%AC%AC%E4%BA%94%E5%B1%8A%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E9%9D%92%E8%AE%AD%E8%90%A5%E9%A1%B9%E7%9B%AE%E4%BC%9A%E8%AE%AE%E7%BA%AA%E8%A6%81/</id>
    <published>2023-01-13T11:55:35.000Z</published>
    <updated>2023-01-13T11:56:19.132Z</updated>
    
    <content type="html"><![CDATA[<h1 id="明确目标">明确目标</h1><h2 id="项目质量">项目质量</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301131955844.png" alt="image-20230113125129881"></p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301131955948.png" alt="image-20230113130844275"  /><blockquote><p>我们的目标是一等奖，重振h68u荣光</p></blockquote><p>有第三届的项目可供参考：<a href="https://github.com/h68u/h68u-tiktok-app">https://github.com/h68u/h68u-tiktok-app</a></p><h2 id="DDL">DDL</h2><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301131955142.png" alt="1280X1280"></p><blockquote><p>约寒假结束，但肯定要提前完成</p></blockquote><h2 id="个人要求">个人要求</h2><blockquote><p>不要当死人</p></blockquote><p>当你遇到问题时：</p><ul><li>自己折腾</li><li>搜索引擎</li><li>B站</li><li>copilot</li><li>ChatGPT</li><li>群里问</li></ul><p>必备技能：</p><ul><li>gorm</li><li>redis</li><li>熟悉 go-zero</li></ul><hr><h1 id="项目规划">项目规划</h1><h2 id="框架">框架</h2><p>go-zero</p><h3 id="原因-优点">原因/优点</h3><ul><li>有现成模板，鄙人的项目：<a href="https://github.com/hdu-packaging-design/hdu-packaging-design-be">https://github.com/hdu-packaging-design/hdu-packaging-design-be</a></li><li>微服务</li><li>及其清晰的项目结构</li><li>方便结合 docker、k8s 部署</li><li>易于搭配各种监控组件</li><li>日后参加面试系统开发</li></ul><h2 id="时间规划">时间规划</h2><p>最晚过年前冲出功能完善的demo，再继续改进</p><h2 id="可改进问题">可改进问题</h2><h3 id="缓存一致性">缓存一致性</h3><p>暂时先更新数据库后删除缓存值，后面再考虑要不要上消息队列等</p><p>可参考资料：</p><ul><li><a href="https://juejin.cn/post/7156237969202872350">聊一聊缓存和数据库不一致性问题的产生及主流解决方案以及扩展的思考</a></li><li><a href="https://juejin.cn/post/7168291215753314311">万字图文讲透数据库缓存一致性问题</a></li></ul><h3 id="热点数据">热点数据</h3><p>分库分表</p><p>可参考资料：</p><p><a href="https://juejin.cn/post/7155784807702593572">好好的系统，为什么要分库分表？</a></p><p><a href="https://juejin.cn/post/7146016771936354312">Mysql大数据表处理方案</a></p><p>B站也有相关的视频</p><p>其他解决方法后面再思考</p><h3 id="监控组件">监控组件</h3><ul><li>prometheus+grafan 服务监控</li><li>jaeger 链路追踪</li><li>kafka+Elasticsearch 日志分析</li></ul><p><a href="https://www.waterflow.link/articles/1661696351405">https://www.waterflow.link/articles/1661696351405</a> 连着3篇</p><p>B 站 go-zero官方视频也有这方面内容</p><h2 id="团队分工">团队分工</h2><p>自由分工</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;明确目标&quot;&gt;明确目标&lt;/h1&gt;
&lt;h2 id=&quot;项目质量&quot;&gt;项目质量&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301131955844.png&quot; alt=&quot;image</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>『CI/CD』使用Webhook通知服务器</title>
    <link href="https://www.nickxu.top/2022/12/19/%E3%80%8ECI-CD%E3%80%8F%E4%BD%BF%E7%94%A8Webhook%E9%80%9A%E7%9F%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://www.nickxu.top/2022/12/19/%E3%80%8ECI-CD%E3%80%8F%E4%BD%BF%E7%94%A8Webhook%E9%80%9A%E7%9F%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2022-12-19T13:50:41.000Z</published>
    <updated>2023-01-29T07:12:17.564Z</updated>
    
    <content type="html"><![CDATA[<p>在前面的 Github Actions 工作流中，我们最后都是直接使用 SSH 连接在服务器上执行命令，但是这样很不优雅，而且会被认为是服务器被异常登录</p><p>所以可以尝试使用 webhook</p><p>简单地说，就是先在服务器准备一个部署脚本，然后一直运行一个守护进程监听请求，触发 GitHub Actions 时发送请求，守护进程被收到后自动执行部署脚本</p><h1 id="准备部署脚本">准备部署脚本</h1><p>准备 <code>redeploy.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">sudo docker login --username=***** registry.cn-hangzhou.aliyuncs.com --password <span class="string">&quot;******&quot;</span></span><br><span class="line"></span><br><span class="line">sudo docker-compose pull</span><br><span class="line"></span><br><span class="line">sudo docker-compose up -d</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个很容易理解，在写完之后记得测试一下能不能成功运行</p><h1 id="编写-webhook">编写 webhook</h1><p>这里为了方便，就直接使用一个库：<a href="https://github.com/adnanh/webhook">https://github.com/adnanh/webhook</a></p><p>这东西看文档直接 apt 就能安装了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install webhook</span><br></pre></td></tr></table></figure><p>使用方法就是编写配置文件，然后运行时带上配置文件，就能根据规则监听请求</p><p>新建一个 <code>webhook.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webhook&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;execute-command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/admin/projects/github-actions-test/redeploy.sh&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;command-working-directory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/admin/projects/github-actions-test&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;trigger-rule&quot;</span><span class="punctuation">:</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;url&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;token&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>简单地说就是规定了执行的脚本，还有触发条件：url 中有 <code>token</code> 参数并且值为 <code>1234567</code> 时就触发</p><p>这东西还有很多高级用法，比如传参数给脚本，具体可以看文档，这里就不演示了</p><p>先测试一下运行效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webhook -hooks webhook.json -verbose</span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301041903842.png" alt="image-20230104190325333"></p><p>然后手动请求一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://www.nickxu.top:9000/hooks/webhook?token=1234567&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301041906287.png" alt="image-20230104190615260"></p><p>看来成功执行了脚本</p><p>现在就用 <a href="/2022/02/15/%E3%80%8ELinux%E3%80%8Fscreen-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95/">screen</a> 或者其他方法让这东西跑在后台就行</p><h1 id="修改-GitHub-Actions-脚本">修改 GitHub Actions 脚本</h1><p>接下来的过程就显而易见了，在 GitHub Actions 脚本中加上这个请求就行</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Webhook</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">curl</span> <span class="string">--location</span> <span class="string">--request</span> <span class="string">GET</span> <span class="string">&#x27;$<span class="template-variable">&#123;&#123; secrets.WEBHOOK_URL &#125;&#125;</span>&#x27;</span> </span><br></pre></td></tr></table></figure><p><img src="https://pic-go-img.oss-cn-hangzhou.aliyuncs.com/202301041922078.png" alt="image-20230104192204053"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在前面的 Github Actions 工作流中，我们最后都是直接使用 SSH 连接在服务器上执行命令，但是这样很不优雅，而且会被认为是服务器被异常登录&lt;/p&gt;
&lt;p&gt;所以可以尝试使用 webhook&lt;/p&gt;
&lt;p&gt;简单地说，就是先在服务器准备一个部署脚本，然后一直运行一个</summary>
      
    
    
    
    <category term="运维" scheme="https://www.nickxu.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="CICD" scheme="https://www.nickxu.top/categories/%E8%BF%90%E7%BB%B4/CICD/"/>
    
    
    <category term="GitHub Actions" scheme="https://www.nickxu.top/tags/GitHub-Actions/"/>
    
    <category term="CICD" scheme="https://www.nickxu.top/tags/CICD/"/>
    
    <category term="Webhook" scheme="https://www.nickxu.top/tags/Webhook/"/>
    
  </entry>
  
</feed>
